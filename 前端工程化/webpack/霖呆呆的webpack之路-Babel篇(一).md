## å»ºè®®æ”¹æˆ: è¯»å®Œè¿™ç¯‡ä½ è¿˜ä¸æ‡‚Babelæˆ‘ç»™ä½ å¯„å£ç½©

### å‰è¨€

æœ€è¿‘åœ¨å­¦ä¹ webpack, å‘ç°äº†webpackä¸­ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç‚¹`babel-loader`, äºæ˜¯å°±æƒ³ç€å­¦ä¹ äº†è§£ä¸€æ³¢[Babel](https://www.babeljs.cn/docs/).

æˆ‘ä»¬åœ¨åšä¸€ä»¶äº‹, å­¦ä¹ ä¸€ä¸ªçŸ¥è¯†ç‚¹çš„æ—¶å€™, éƒ½åº”è¯¥æ˜¯æŠ±æœ‰ä¸€ä¸ªç›®çš„å»åšçš„.

åœ¨ä½ èŠ±äº†å¤§æŠŠæ—¶é—´å¤§æŠŠç²¾åŠ›å»å­¦ä¹ è¿™ä¸ªçŸ¥è¯†çš„æ—¶å€™, å®ƒèƒ½å¸¦ç»™ä½ ä»€ä¹ˆ ğŸ¤”ï¸ ? èƒ½å¸®åŠ©åˆ°ä½ ä»€ä¹ˆğŸ¤”ï¸ ?

![ä½ åˆ°åº•æœ‰ä»€ä¹ˆè½¯ç”¨.jpg](https://user-gold-cdn.xitu.io/2020/2/15/1704712a24e5a4c9?w=500&h=375&f=png&s=141547)

å°±åƒæˆ‘å­¦ä¹ Babelä¸€æ ·, ä¹‹å‰ä¸€ç›´åªçŸ¥é“å®ƒæ˜¯ä¸€ä¸ª`JS`ç¼–è¯‘å™¨, å¤§æ¦‚åŠŸèƒ½æ˜¯èƒ½å¸®æˆ‘ä»¬åœ¨æ—§çš„æµè§ˆå™¨ç¯å¢ƒä¸­å°†ES6+ä»£ç è½¬æ¢æˆå‘åå…¼å®¹ç‰ˆæœ¬çš„`JS`ä»£ç , ä½†æ˜¯å…¶ä¸­é‡è¦çš„è½¬æ¢åŠŸèƒ½æ˜¯é ä»€ä¹ˆå®ç°, ä»¥åŠé‡Œé¢åˆ°åº•æœ‰ä¸ªä»€ä¹ˆå­¦é—®æ˜¯æˆ‘æ²¡æ·±å…¥äº†è§£çš„, å®ƒå¯¹æˆ‘å­¦ä¹ webpackæœ‰ä»€ä¹ˆå¸®åŠ©?

åœ¨è¿™ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘å¹¶æ²¡æœ‰ä»‹ç»è¿‡äºæ·±å…¥çš„å†…å®¹, ä½†æ˜¯å¦‚æœæŠŠå®ƒå½“æˆä¸€ä¸ªå…¥é—¨Babelçš„æ•™ææ¥çœ‹é‚£æˆ‘ç›¸ä¿¡å®ƒå¯¹ä½ æ˜¯æœ‰ä¸€å®šå¸®åŠ©çš„. ä¸ä¿¡å¦‚æœä½ è¯»å®Œäº†å®ƒä¹‹åå†å»çœ‹çœ‹å®˜æ–¹çš„æ–‡æ¡£, ä¸€å®šè§‰å¾—éƒ½å¯ä»¥çœ‹æ‡‚äº†. **ä¸ç„¶çš„è¯è¯·è¯„è®ºåŒºç•™ä¸‹ä½ çš„åœ°å€, çœ‹æˆ‘ç»™ä¸ç»™ä½ å¯„å£ç½©...**

ä¸æ‹å¼¯æŠ¹è§’äº†, å˜»å˜» ğŸ˜, è®©æˆ‘ä»¬çœ‹çœ‹é€šè¿‡è¿™ä¸€ç« èŠ‚çš„é˜…è¯»ä½ èƒ½å­¦ä¹ åˆ°ä»€ä¹ˆ:

- @babel/cli
- plugins
- presets
- é…ç½®Babel
- polyfill



### å‰æœŸå‡†å¤‡

å­¦ä¹ ä¸€ä¸ªæ–°çš„çŸ¥è¯†, æˆ‘è¿˜æ˜¯åå‘äºç”¨æ¡ˆä¾‹çš„çš„æ–¹å¼æ¥æ‰“å¼€è®²è§£å®ƒ.

æ‰€ä»¥åœ¨æ­£å¼å¼€å§‹é˜…è¯»ä¹‹å‰, è®©æˆ‘ä»¬å…ˆæ¥å‡†å¤‡ä¸€ä¸ªè¿™æ ·çš„æ¡ˆä¾‹é¡¹ç›®:

```
mkdir babel-basic && cd babel-basic
npm init -y
mkdir src && cd src
touch index.js
```

ä¸€é¡¿æ“ä½œä¹‹å, æˆ‘ä»¬æ–°å»ºçš„é¡¹ç›®ç›®å½•ä¸º:

```
/babel-basic
	|- /src
		|- index.js
	|- package.json
```

ç°åœ¨`package.json`æ˜¯æœ€åŸå§‹çš„é…ç½®, è€Œ`index.js`æš‚æ—¶æ²¡æœ‰å†™å†…å®¹.

**package.json**:

```json
{
  "name": "babel-basic",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {}
}

```

ä¸‹é¢æˆ‘éƒ½å°†å›´ç»•è¿™ä¸ª`babel-basic`é¡¹ç›®æ¥è¿›è¡Œè®²è§£, æˆ‘å¸Œæœ›ä½ ä¹Ÿèƒ½åœ¨æœ¬åœ°å‡†å¤‡ä¸€ä¸ªè¿™æ ·çš„é¡¹ç›®æ¡ˆä¾‹, ä»¥ä¾¿ä½ æ›´å¥½çš„ç†è§£æˆ‘æ¥ä¸‹æ¥è¦è¯´çš„å†…å®¹.



### @babel/core

æˆ‘ä»¬å­¦ä¹ Babel, é¦–å…ˆè¦äº†è§£ä¸€ä¸ªå«`@babel/core` çš„ä¸œè¥¿, å®ƒæ˜¯Babelçš„æ ¸å¿ƒæ¨¡å—.

å½“ç„¶è¦ä½¿ç”¨å®ƒ, æˆ‘ä»¬å¾—å…ˆå®‰è£…:

```
$ npm i --save-dev @babel/core
```

å®‰è£…æˆåŠŸä¹‹åå°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ä½¿ç”¨äº†, ä½ å¯ä»¥é‡‡ç”¨`CommonJS`çš„å¼•ç”¨æ–¹å¼:

```
const babel = require('@babel/core');
babel.transform("code", options);
```

è¿™é‡Œçš„çŸ¥è¯†ç‚¹æœ‰å¾ˆå¤š, ä¸è¿‡ä½ ä¸ç”¨æ€¥äºçš„æŒæ¡å®ƒ, åªéœ€è¦çŸ¥é“å®ƒæ˜¯Babelçš„æ ¸å¿ƒ, è®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹.

### @babel/cli

å†ç„¶åå°±æ˜¯`@babel/cli`, å®ƒæ˜¯ä¸€ä¸ªç»ˆç«¯è¿è¡Œå·¥å…·, å†…ç½®çš„æ’ä»¶,è¿è¡Œä½ ä»ç»ˆç«¯ä½¿ç”¨babelçš„å·¥å…·.

åŒæ ·, å®ƒä¹Ÿéœ€è¦å…ˆå®‰è£…:

```
$ npm i --save-dev @babel/cli @babel/core
```

è®©æˆ‘ä»¬å®‰è£…`@babel/cli`çš„åŒæ—¶å†æ¥å®‰è£…ä¸€ä¸‹`@babel/core`, 

ç°åœ¨, è®©æˆ‘å…ˆåœ¨`src/index.js`ä¸­å†™ä¸Šä¸€æ®µç®€å•çš„ä»£ç , å¹¶æ¥çœ‹çœ‹å®ƒçš„åŸºæœ¬ç”¨æ³•.

**src/index.js**:

```javascript
const fn = () => 1; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
console.log(fn());
```

**ç”¨æ³•ä¸€**: å‘½ä»¤è¡Œçš„å½¢å¼(åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œè¯­å¥):

```
$ ./node_modules/.bin/babel src --out-dir lib
```

è¿™æ®µè¯­å¥çš„æ„æ€æ˜¯: å®ƒä½¿ç”¨æˆ‘ä»¬è®¾ç½®çš„**è§£ææ–¹å¼**æ¥è§£æ`src`ç›®å½•ä¸‹çš„æ‰€æœ‰`JS`æ–‡ä»¶, å¹¶å°†è½¬æ¢åçš„æ¯ä¸ªæ–‡ä»¶éƒ½è¾“å‡ºåˆ°`lib`ç›®å½•ä¸‹.

ä½†æ˜¯æ³¨æ„äº†, ç”±äºæˆ‘ä»¬ç°åœ¨æ²¡æœ‰è®¾ç½®ä»»ä½•çš„è§£ææ–¹å¼, æ‰€ä»¥ä½ åœ¨æ‰§è¡Œäº†è¿™æ®µè¯­å¥ä¹‹å, èƒ½çœ‹åˆ°é¡¹ç›®ä¸­å¤šäº†ä¸€ä¸ª`lib`ç›®å½•, è€Œä¸”é‡Œé¢çš„`JS`ä»£ç å’Œ`src`ä¸­çš„æ˜¯ä¸€æ ·çš„. è‡³äºæˆ‘è¯´çš„**è§£ææ–¹å¼**, å°±æ˜¯åé¢æˆ‘è¦ä»‹ç»çš„pluginså’Œpresets.

å¦å¤–, å¦‚æœä½ æ˜¯`npm@5.2.0`é™„å¸¦çš„`npm`åŒ…è¿è¡Œå™¨çš„è¯, å°±å¯ä»¥ç”¨`npx babel`æ¥ä»£æ›¿`./node_modules/.bin/babel`:

```
$ npx babel src --out-dir lib
```

**ç”¨æ³•äºŒ**: ç»™`package.json`ä¸­é…ç½®ä¸€æ®µè„šæœ¬å‘½ä»¤:

```diff
{
    "name": "babel-basic",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "scripts": {
+       "build": "babel src -d lib"
    },
    "keywords": [],
    "author": "",
    "license": "ISC",
    "devDependencies": {
+       "@babel/cli": "^7.8.4",
+       "@babel/core": "^7.8.4"
    }
}
```

ç°åœ¨è¿è¡Œ`npm run build`æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„, `-d`æ˜¯`--out-dir`çš„ç¼©å†™...

(æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„ `--out-dir` é€‰é¡¹ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `--help` è¿è¡Œå®ƒæ¥æŸ¥çœ‹ cli å·¥å…·æ¥å—çš„å…¶ä½™é€‰é¡¹ã€‚ä½†å¯¹æˆ‘ä»¬æ¥è¯´æœ€é‡è¦çš„æ˜¯ `--plugins` å’Œ `--presets`ã€‚)

```
$ npx babel --help
```



### æ’ä»¶plugins

#### åŸºæœ¬æ¦‚å¿µ

çŸ¥é“äº†Babelçš„åŸºæœ¬ç”¨æ³•ä¹‹å, è®©æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ä»£ç è½¬æ¢.

ç°åœ¨è¦ä»‹ç»çš„æ˜¯**æ’ä»¶plugins**, å®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª`JS`ç¨‹åº, æŒ‡ç¤ºç€Babelå¦‚ä½•å¯¹ä»£ç è¿›è¡Œè½¬æ¢.

æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶æ¥åº”ç”¨ä½ æƒ³è¦çš„ä»»ä½•ä»£ç è½¬æ¢.

#### æ’ä»¶æ¡ˆä¾‹(ç®­å¤´å‡½æ•°æ’ä»¶)

ä½†æ˜¯é¦–å…ˆè®©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€äº›åŸºæœ¬çš„æ’ä»¶.

å¦‚æœä½ æ˜¯è¦å°†ES6+è½¬æˆES5, å¯ä»¥ä¾èµ–å®˜æ–¹æ’ä»¶, ä¾‹å¦‚:

`@babel/plugin-transform-arrow-functions`:

```
$ cnpm i --save-dev @babel/plugin-transform-arrow-functions
$ npx babel src --out-dir lib --plugins=@babel/plugin-transform-arrow-functions
```

è¿™ä¸ªæ’ä»¶çš„ä½œç”¨æ˜¯å°†ç®­å¤´å‡½æ•°è½¬æ¢ä¸ºES5å…¼å®¹çš„å‡½æ•°:

è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çš„`src/index.js`å—:

```javascript
const fn = () => 1; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
console.log(fn());
```

ç°åœ¨ç¼–è¯‘ä¹‹å, ä½ å†æ‰“å¼€`lib/index.js`æ¥çœ‹çœ‹.

 å®ƒæ˜¯ä¸æ˜¯è¢«è½¬æ¢ä¸ºES5çš„ä»£ç äº†å‘¢? ğŸ˜

```javascript
const fn = function () {
  return 1;
}; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


console.log(fn());
```

æ£é¼“äº†è¿™ä¹ˆä¹…, ç»ˆäºçœ‹åˆ°äº†ä¸€ç‚¹å®é™…çš„æ•ˆæœ, æ­¤æ—¶æœ‰ç‚¹å°å…´å¥‹å•ŠğŸ˜„

è¡¨æƒ…åŒ…å¼€å¿ƒ

è™½ç„¶æˆ‘ä»¬å·²ç»å®ç°äº†ç®­å¤´å‡½æ•°è½¬æ¢çš„åŠŸèƒ½, ä½†æ˜¯`ES6+`å…¶å®ƒçš„è¯­æ³•(æ¯”æ±‚å¹‚è¿ç®—ç¬¦`**`)å´å¹¶ä¸èƒ½è½¬æ¢, è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªä½¿ç”¨äº†`@babel/plugin-transform-arrow-functions`è¿™ä¸ªåŠŸèƒ½æ’ä»¶, æ²¡æœ‰ä½¿ç”¨å…¶å®ƒçš„äº†.



### Presets:

#### åŸºæœ¬æ¦‚å¿µ

å¦‚æœæƒ³è¦è½¬æ¢ES6+çš„å…¶å®ƒä»£ç ä¸ºES5, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨"preset"æ¥ä»£æ›¿é¢„å…ˆè®¾å®šçš„**ä¸€ç»„æ’ä»¶**, è€Œä¸æ˜¯é€ä¸€æ·»åŠ æˆ‘ä»¬æƒ³è¦çš„æ‰€æœ‰æ’ä»¶.

**è¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªpresetå°±æ˜¯ä¸€ç»„æ’ä»¶çš„é›†åˆ.**

presetså’Œpluginsä¸€æ ·, ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„preset, åˆ†äº«ä½ éœ€è¦çš„ä»»ä½•æ’ä»¶ç»„åˆ.



#### @babel/preset-env

ä¾‹å¦‚, æˆ‘ä»¬ä½¿ç”¨`env`preset:

```
cnpm i --save-dev @babel/preset-env
```

`env`presetè¿™ä¸ªpresetåŒ…æ‹¬æ”¯æŒç°ä»£JavaScript(ES6+)çš„æ‰€æœ‰æ’ä»¶.

æ‰€ä»¥ä¹Ÿå°±æ˜¯è¯´ä½ å®‰è£…ä½¿ç”¨äº†`env`presetä¹‹å, å°±å¯ä»¥çœ‹åˆ°å…¶å®ƒES6+è¯­æ³•çš„è½¬æ¢äº†.

ç°åœ¨è®©æˆ‘ä»¬æ¥ç”¨ç”¨ES7ä¸­çš„**æ±‚å¹‚è¿ç®—ç¬¦**å’Œ**å‡½æ•°å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·**è¿™ä¸¤ä¸ªåŠŸèƒ½å§:

**src/index.js**:

```javascript
const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦
let foo = function(a, b, c, ) { // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
    console.log('a:', a)
    console.log('b:', b)
    console.log('c:', c)
}
foo(1, 3, 4)
console.log(fn());
console.log(num);
```

ç„¶ååœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨è¿™ä¸ª`preset`:

```
npx babel src --out-dir lib --presets=@babel/preset-env
```

ç°åœ¨æ‰“å¼€`lib/src`çœ‹çœ‹:

```javascript
"use strict";

var fn = function fn() {
  return 1;
}; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


var num = Math.pow(3, 2);

var foo = function foo(a, b, c) {
  console.log('a:', a);
  console.log('b:', b);
  console.log('c:', c);
};

foo(1, 3, 4);
console.log(fn());
console.log(num);
```

æ±‚å¹‚è¿ç®—ç¬¦è¢«è½¬æ¢ä¸ºæˆ`Math.pow()`

å‡½æ•°å‚æ•°çš„æœ€åä¸€ä¸ªé€—å·ä¹Ÿè¢«å»æ‰äº†.



æˆªæ­¢åˆ°ç°åœ¨, çœ‹å®Œäº†`@babel/core`ã€`@babel/cli`ã€`plugins`ã€`presets`, ç›¸ä¿¡ä½ å¯¹Babelçš„åŠŸèƒ½æœ‰ä¸€å®šäº†è§£äº†å§, ä½†æ˜¯çœŸæ­£ä½¿ç”¨èµ·æ¥æˆ‘ä»¬ä¸å¯èƒ½éƒ½æ˜¯é å‘½ä»¤è¡Œçš„å½¢å¼å§, æ²¡é”™, æ¥ä¸‹æ¥æˆ‘è¦å°†è¿™äº›åŠŸèƒ½åšæˆé…ç½®é¡¹.



### é…ç½®

ä¸Šé¢ğŸ‘†ä»‹ç»çš„éƒ½æ˜¯ä¸€äº›ç»ˆç«¯ä¼ å…¥CLIçš„æ–¹å¼, åœ¨å®é™…ä½¿ç”¨ä¸Š, æˆ‘ä»¬æ›´åŠ åå‘äº**é…ç½®æ–‡ä»¶**.

ä¾‹å¦‚æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`babel.config.js`æ–‡ä»¶:

```javascript
const presets = [
	[
    "@babel/env",
    {
      targets: {
        edge: "17",
        chrome: "64",
        firefox: "60",
        safari: "11.1"
      }
    }
  ]	
]

module.exports = { presets };
```

åŠ ä¸Šè¿™ä¸ªé…ç½®çš„ä½œç”¨æ˜¯:

- ä½¿ç”¨äº†`env`presetè¿™ä¸ªpreset
- `env`presetåªä¼šä¸ºç›®æ ‡æµè§ˆå™¨ä¸­æ²¡æœ‰çš„åŠŸèƒ½åŠ è½½è½¬æ¢æ’ä»¶

ç°åœ¨ä½ è¦ä½¿ç”¨è¿™ä¸ªé…ç½®å°±å¾ˆç®€å•äº†, ç›´æ¥ç”¨æˆ‘ä»¬å‰é¢**package.json**é…ç½®çš„å‘½ä»¤è¡Œè¯­å¥:

```javascript
{
	"scripts": {
		"build": "babel src -d lib"
	}
}
```

æ‰§è¡Œ`npm run build`å°±å¯ä»¥äº†.

è¿™ä¸ªå‘½ä»¤è¡Œè¯­å¥çœ‹èµ·æ¥å¹¶æ²¡æœ‰ä¿®æ”¹, é‚£æ˜¯å› ä¸ºå®ƒé»˜è®¤ä¼šå»å¯»æ‰¾è·Ÿæ ¹ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸º`babel.config.js`çš„æ–‡ä»¶(æˆ–è€…`babelrc.js`ä¹Ÿå¯ä»¥, è¿™ä¸ªåœ¨ä¹‹åçš„`ä½¿ç”¨babelçš„å‡ ç§æ–¹å¼`ä¸­ä¼šè¯´åˆ°), æ‰€ä»¥å…¶å®å°±ç›¸å½“äºä»¥ä¸‹è¿™ä¸ªé…ç½®:

```javascript
{
	"scripts": {
		"build": "babel src -d lib --config-file ./babel.config.js"
	}
}
```

å› æ­¤å¦‚æœä½ çš„Babelé…ç½®æ–‡ä»¶æ˜¯`babel.config.js`çš„è¯, è¿™ä¸¤ç§æ•ˆæœæ˜¯ä¸€æ ·çš„.

(`--config-file`æŒ‡ä»¤å°±ç±»ä¼¼äºwebpackä¸­çš„`--config`, ç”¨äºæŒ‡å®šä»¥å“ªä¸ªé…ç½®æ–‡ä»¶æ„å»º)



è¿™é‡Œæˆ‘é‡ç‚¹è¦è¯´ä¸€ä¸‹**åªä¼šä¸ºç›®æ ‡æµè§ˆå™¨ä¸­æ²¡æœ‰çš„åŠŸèƒ½åŠ è½½è½¬æ¢æ’ä»¶**è¿™å¥è¯çš„æ„æ€.

ä¾‹å¦‚æˆ‘è¿™é‡Œé…ç½®çš„å…¶ä¸­ä¸€é¡¹æ˜¯`edge: "17"`, é‚£å°±è¡¨ç¤ºå®ƒè½¬æ¢ä¹‹åçš„ä»£ç æ”¯æŒåˆ°`edge17`.

æ‰€ä»¥ä½ ä¼šå‘ç°, å¦‚æœä½ ç”¨äº†æˆ‘ä¸Šé¢`babel.config.js`çš„é…ç½®ä¹‹åç”Ÿæˆçš„`lib`æ–‡ä»¶å¤¹ä¸‹çš„ä»£ç å¥½åƒå¹¶æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆæ”¹å˜, ä¹Ÿå°±æ˜¯å®ƒå¹¶æ²¡æœ‰è¢«è½¬æ¢æˆ`ES5`çš„ä»£ç :

**src/index.js**:

```javascript
const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦
let foo = function(a, b, c, ) { // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
    console.log('a:', a)
    console.log('b:', b)
    console.log('c:', c)
}
foo(1, 3, 4)
console.log(fn());
console.log(num);
```

**ä½¿ç”¨`babel.config.js`é…ç½®ä¹‹åæ„å»ºçš„`lib/index.js`**:

```javascript
"use strict";

const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦

let foo = function foo(a, b, c) {
  // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
  console.log('a:', a);
  console.log('b:', b);
  console.log('c:', c);
};

foo(1, 3, 4);
console.log(fn());
console.log(num);
```

ç®­å¤´å‡½æ•°ä¾æ—§æ˜¯ç®­å¤´å‡½æ•°, æ±‚å¹‚è¿ç®—ç¬¦ä¾æ—§æ˜¯æ±‚å¹‚è¿ç®—ç¬¦.

**è¿™æ˜¯å› ä¸ºåœ¨Edge17æµè§ˆå™¨ä¸­æ”¯æŒES7çš„è¿™äº›åŠŸèƒ½, æ‰€ä»¥å®ƒå°±æ²¡æœ‰å¿…è¦å°†å…¶è½¬æ¢äº†, å®ƒåªä¼šä¸ºç›®æ ‡æµè§ˆå™¨ä¸­æ²¡æœ‰çš„åŠŸèƒ½åŠ è½½è½¬æ¢æ’ä»¶!!!**

å¦‚æœæˆ‘ä»¬å°†`edge17`æ”¹æˆ`edge10`çœ‹çœ‹ ğŸ¤”ï¸?

**babel.config.js**:

```diff
const presets = [
    [
        "@babel/env",
        {
            targets: {
-               edge: "17",
+               edge: "10",
                firefox: "60",
                chrome: "67",
                safari: "11.1",
            },
        },
    ],
];

module.exports = { presets };
```

ä¿å­˜é‡æ–°è¿è¡Œ`npm run build`, ä½ å°±ä¼šå‘ç°`lib/index.js`ç°åœ¨æœ‰æ‰€æ”¹å˜äº†:

```javascript
"use strict";

var fn = function fn() {
  return 1;
}; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


var num = Math.pow(3, 2); // ES7æ±‚å¹‚è¿ç®—ç¬¦

var foo = function foo(a, b, c) {
  // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
  console.log('a:', a);
  console.log('b:', b);
  console.log('c:', c);
};

foo(1, 3, 4);
console.log(fn());
console.log(num);
```



### Polyfill

Pluginsæ˜¯æä¾›çš„æ’ä»¶, ä¾‹å¦‚ç®­å¤´å‡½æ•°è½¬æ™®é€šå‡½æ•°`@babel/plugin-transform-arrow-functions`

Presetsæ˜¯ä¸€ç»„Pluginsçš„é›†åˆ.

**è€ŒPolyfillæ˜¯å¯¹æ‰§è¡Œç¯å¢ƒæˆ–è€…å…¶å®ƒåŠŸèƒ½çš„ä¸€ä¸ªè¡¥å…….**

ä»€ä¹ˆæ„æ€å‘¢ ğŸ¤”ï¸?

å°±åƒç°åœ¨ä½ æƒ³åœ¨`edge10`æµè§ˆå™¨ä¸­ä½¿ç”¨ES7ä¸­çš„æ–¹æ³•`includes()`, ä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸ªç‰ˆæœ¬çš„æµè§ˆå™¨ç¯å¢ƒæ˜¯ä¸æ”¯æŒä½ ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„, æ‰€ä»¥å¦‚æœä½ å¼ºè¡Œä½¿ç”¨å¹¶ä¸èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœ.

è€Œ`polyfill`çš„ä½œç”¨æ­£æ˜¯å¦‚æ­¤, çŸ¥é“ä½ çš„ç¯å¢ƒä¸å…è®¸, é‚£å°±å¸®ä½ å¼•ç”¨ä¸€ä¸ªè¿™ä¸ªç¯å¢ƒ, ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ç¼–è¯‘åçš„ä»£ç å°±ä¼šå˜æˆè¿™æ ·:

```javascript
// åŸæ¥çš„ä»£ç 
var hasTwo = [1, 2, 3].includes(2);

// åŠ äº†polyfillä¹‹åçš„ä»£ç 
require("core-js/modules/es7.array.includes");
require("core-js/modules/es6.string.includes");
var hasTwo = [1, 2, 3].includes(2);
```

è¿™æ ·è¯´ä½ åº”è¯¥å°±èƒ½çœ‹æ‡‚å®ƒçš„ä½œç”¨äº†å§ ğŸ˜

è¡¨æƒ…åŒ…è£…é€¼

ç°åœ¨å°±è®©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªé‡è¦çš„`polyfill`, å®ƒå°±æ˜¯`babel/polyfill`.

`babel/polyfill`ç”¨æ¥æ¨¡æ‹Ÿå®ŒæˆES6+ç¯å¢ƒ:

- å¯ä»¥ä½¿ç”¨åƒ`Promise`æˆ–è€…`WeakMap`è¿™æ ·çš„æ–°å†…ç½®å‡½æ•°
- å¯ä»¥ä½¿ç”¨åƒ`Array.from`æˆ–è€…`Object.assign`è¿™æ ·çš„é™æ€æ–¹æ³•
- å¯ä»¥ä½¿ç”¨åƒ`Array.prototype.includes`è¿™æ ·çš„å®ä¾‹æ–¹æ³•
- è¿˜æœ‰`generator`å‡½æ•°

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹, Polyfillå¢åŠ äº†**å…¨å±€èŒƒå›´**ä»¥åŠåƒStringè¿™æ ·çš„åŸç”ŸåŸå‹.

è€Œ`@babel/polyfill`æ¨¡å—åŒ…æ‹¬äº†`core-js`å’Œè‡ªå®šä¹‰`regenerator runtime`

å¯¹äº**åº“/å·¥å…·**æ¥è¯´, å¦‚æœä½ ä¸éœ€è¦åƒ`Array.prototype.includes`è¿™æ ·çš„å®ä¾‹æ–¹æ³•, å¯ä»¥ä½¿ç”¨`transform runtime`æ’ä»¶, è€Œä¸æ˜¯ä½¿ç”¨æ±¡æŸ“å…¨å±€çš„`@babel/polyfill`.

å¯¹äº**åº”ç”¨ç¨‹åº**, æˆ‘ä»¬å»ºè®®å®‰è£…ä½¿ç”¨`@babel/polyfill`

```
cnpm i --save @babel/polyfill
```

(æ³¨æ„ `--save` é€‰é¡¹è€Œä¸æ˜¯ `--save-dev`ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªéœ€è¦åœ¨æºä»£ç ä¹‹å‰è¿è¡Œçš„ polyfillã€‚)

ä½†æ˜¯ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`env`preset, è¿™é‡Œä¸ªé…ç½®ä¸­æœ‰ä¸€ä¸ªå«åš `"useBuiltIns"`çš„é€‰é¡¹

å¦‚æœå°†è¿™ä¸ªé€‰æ‹©è®¾ç½®ä¸º`"usage"`, å°±åªåŒ…æ‹¬ä½ éœ€è¦çš„polyfill

æ­¤æ—¶çš„`babel.config.js`è°ƒæ•´ä¸º:

```diff
const presets = [
	[
		"@babel/env",
		{
			targets: {
				edge: "17",
				chrome: "64",
				firefox: "67",
				safari: '11.1'
			},
+			useBuiltIns: "usage"
		}
	]
]

module.exports = { presets }
```

å®‰è£…é…ç½®äº†`@babel/polyfill`, Babelå°†æ£€æŸ¥ä½ çš„æ‰€æœ‰ä»£ç , ç„¶åæŸ¥æ‰¾ç›®æ ‡ç¯å¢ƒä¸­ç¼ºå°‘çš„åŠŸèƒ½, å¹¶å¼•å…¥ä»…åŒ…å«æ‰€éœ€çš„polyfill

(å¦‚æœæˆ‘ä»¬æ²¡æœ‰å°† `env` preset çš„ `"useBuiltIns"` é€‰é¡¹çš„è®¾ç½®ä¸º `"usage"` ï¼Œå°±å¿…é¡»åœ¨å…¶ä»–ä»£ç ä¹‹å‰ require *ä¸€æ¬¡å®Œæ•´*çš„ polyfillã€‚)

è¿˜æ˜¯ä¸Šé¢ğŸ‘†çš„é‚£ä¸ªä¾‹å­, æˆ‘ä»¬æ¥æ”¹é€ ä¸€ä¸‹, ä½¿ç”¨`Edge17`ä¸­æ²¡æœ‰çš„`Promise.prototype.finally`:

**src/index.js**:

```javascript
const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦
let hasTwo = [1, 2, 3].includes(2)
let foo = function(a, b, c, ) { // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
    console.log('a:', a)
    console.log('b:', b)
    console.log('c:', c)
}
foo(1, 3, 4)
Promise.resolve().finally();
console.log(fn());
console.log(num);
console.log(hasTwo);
```

ç°åœ¨æ‰§è¡Œ`npm run build`ä¹‹åç”Ÿæˆçš„`lib/index.js`å˜æˆäº†:

```javascript
"use strict";

require("core-js/modules/es7.promise.finally");

const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦

let hasTwo = [1, 2, 3].includes(2);

let foo = function foo(a, b, c) {
  // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
  console.log('a:', a);
  console.log('b:', b);
  console.log('c:', c);
};

foo(1, 3, 4);
Promise.resolve().finally();
console.log(fn());
console.log(num);
console.log(hasTwo);
```

`@babel/polyfill`å¸®æˆ‘ä»¬å¼•å…¥äº†`Edge17` ç¯å¢ƒä¸­æ²¡æœ‰çš„`promise.finally()` 



### è¢«deprecatedçš„@babel/polyfill

ä¸Šé¢æˆ‘ä»‹ç»äº†ä¸€ç§åä¸º`@babel/polyfill`çš„polypill, å…¶å®å®ƒåœ¨Babel7.4.0ä»¥ä¸Šå·²ç»ä¸è¢«æ¨èä½¿ç”¨äº†.

è€Œæ˜¯æ¨èä½¿ç”¨`core-js@3`+`@babel/preset-env`ç„¶åè®¾ç½®`@babel/preset-env`çš„`corejs`é€‰é¡¹ä¸º`3`.

å› æ­¤å¦‚æœä½ æŒ‰ç€æˆ‘æ–‡ç« ä¸­è®²æ–¹å¼ä½¿ç”¨`@babel/polyfill`, æ˜¯å¯ä»¥å®ç°çš„, ä¸è¿‡æ§åˆ¶å°ä¸­ä¼šæŠ›å‡ºä¸€ä¸ªè­¦å‘Šâš ï¸:

```
WARNING: We noticed you're using the `useBuiltIns` option without declaring a core-js version. Currently, we assume version 2.x when no version is passed. Since this default version will likely change in future versions of Babel, we recommend explicitly setting the core-js version you are using via the `corejs` option.

You should also be sure that the version you pass to the `corejs` option matches the version specified in your `package.json`'s `dependencies` section. If it doesn't, you need to run one of the following commands:

  npm install --save core-js@2    npm install --save core-js@3
  yarn add core-js@2              yarn add core-js@3
```

è§£å†³åŠæ³•æ˜¯å¸è½½æ‰`@babel/polyfill`, ç„¶åé‡æ–°å®‰è£…`core-js@ç‰ˆæœ¬å·`, ç„¶åé‡æ–°é…ç½®ä¸€äº›babel.config.jsæ–‡ä»¶.

1. å®‰è£…`core-js@3`:

```
cnpm i --save core-js@3
```

2. æ·»åŠ `corejs`é€‰é¡¹:

```diff
const presets = [
	[
		"@babel/env",
		{
			targets: {
				edge: "17",
				chrome: "64",
				firefox: "67",
				safari: '11.1'
			},
			useBuiltIns: "usage",
+			corejs: 3
		}
	]
]

module.exports = { presets }
```

`(useBuiltIns`é€‰é¡¹è¿˜æ˜¯ä¸èƒ½å»æ‰)

ç°åœ¨é‡æ–°`npm run build`ä¹‹åå°±ä¸ä¼šæœ‰è¿™ä¸ªè­¦å‘Šäº†, è€Œä¸”ç”Ÿæˆçš„`lib`ä¹Ÿæ˜¯æ­£ç¡®çš„.

(æ„Ÿè°¢æ˜å‹ [KsRyY](https://juejin.im/user/5c5ed71cf265da2dcf625f1c) çš„ç»†å¿ƒæç¤ºğŸ˜ )

### å°ç»“

- `babel/cli` å…è®¸æˆ‘ä»¬ä»ç»ˆç«¯è¿è¡ŒBabel
- `env`preset åªåŒ…å«æˆ‘ä»¬ä½¿ç”¨çš„åŠŸèƒ½çš„è½¬æ¢,å®ç°æˆ‘ä»¬çš„ç›®æ ‡æµè§ˆå™¨ä¸­ç¼ºå°‘çš„åŠŸèƒ½
- `@babel/polyfill`å®ç°æ‰€æœ‰æ–°çš„`JS`åŠŸèƒ½, ä¸ºç›®æ ‡æµè§ˆå™¨å¼•å…¥ç¼ºå°‘çš„ç¯å¢ƒ(ä½†æ˜¯Babel7.4.0ä»¥ä¸Šä¸æ¨èä½¿ç”¨)



### åè¯­

å“ˆå“ˆğŸ˜„, ä¸å¥½æ„æ€å¼€å¤´éª—äº†å¤§å®¶...å¯„å£ç½©ä¸å­˜åœ¨çš„ ğŸ˜‚ æˆ‘è‡ªå·±ä¹Ÿæ˜¯è¢«å…³åœ¨å®¶é‡Œä¸æ•¢å‡ºé—¨...

çœ‹æˆ‘ä¸ºäº†èƒ½è®©å¤§å®¶è€å®å‘†å®¶å­¦ä¹ å¤šè´¹å¿ƒå•Š ğŸ˜‚

æœ€å...

å–œæ¬¢**éœ–å‘†å‘†**çš„å°ä¼™è¿˜å¸Œæœ›å¯ä»¥å…³æ³¨éœ–å‘†å‘†çš„å…¬ä¼—å· `LinDaiDai` æˆ–è€…æ‰«ä¸€æ‰«ä¸‹é¢çš„äºŒç»´ç ğŸ‘‡ğŸ‘‡ğŸ‘‡.

æˆ‘ä¼šä¸å®šæ—¶çš„æ›´æ–°ä¸€äº›å‰ç«¯æ–¹é¢çš„çŸ¥è¯†å†…å®¹ä»¥åŠè‡ªå·±çš„åŸåˆ›æ–‡ç« ğŸ‰

ä½ çš„é¼“åŠ±å°±æ˜¯æˆ‘æŒç»­åˆ›ä½œçš„ä¸»è¦åŠ¨åŠ› ğŸ˜Š.

ç›¸å…³æ¨è:

[ã€ŠJavaScriptè¿›é˜¶-æ‰§è¡Œä¸Šä¸‹æ–‡(ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡ä¸€ç¯‡å°±å¤Ÿäº†)ã€‹](https://juejin.im/post/5db85b866fb9a0207d4cbf92)

[ã€Šå…¨ç½‘æœ€è¯¦bpmn.jsæ•™æã€‹](https://juejin.im/post/5def372af265da33c84a4818)

[ã€Šéœ–å‘†å‘†ä½ æ¥è¯´è¯´æµè§ˆå™¨ç¼“å­˜å§ã€‹](https://juejin.im/post/5e2d7d3a6fb9a02fec665157)

[ã€Šæ€æ ·è®©åå°å°å“¥å“¥å¿«é€Ÿå¯¹æ¥ä½ çš„å‰ç«¯é¡µé¢ã€‹](https://juejin.im/post/5d89b2a7f265da03dd3db2ca)

