> å¸Œæ²ƒENOWå¤§å‰ç«¯
>
> å…¬å¸å®˜ç½‘ï¼š[CVTE(å¹¿å·è§†æºè‚¡ä»½)](http://www.cvte.com/)
>
> å›¢é˜Ÿï¼šCVTEæ——ä¸‹æœªæ¥æ•™è‚²å¸Œæ²ƒè½¯ä»¶å¹³å°ä¸­å¿ƒenowå›¢é˜Ÿ

**æœ¬æ–‡ä½œè€…ï¼š**

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52894355d9bb445fadb78f0a8ef09169~tplv-k3u1fbpfcp-zoom-1.image)



## å‰è¨€

ä½ ç›¼ä¸–ç•Œï¼Œæˆ‘ç›¼æœ›ä½ æ— `bug`ã€‚Hello å¤§å®¶å¥½ï¼æˆ‘æ˜¯éœ–å‘†å‘†ã€‚

è¿™ç¯‡æ–‡ç« é¦–å‘äºæˆ‘ä»¬å›¢é˜Ÿçš„æ˜é‡‘è´¦å·ã€å¸Œæ²ƒENOWå¤§å‰ç«¯ã€‘ï¼Œå¾ˆè£å¹¸æˆä¸ºç¬¬ä¸€ç¯‡æ–‡ç« çš„ç¼–å†™äººã€‚åœ¨æ¥ä¸‹æ¥æ—¥å­ï¼Œæˆ‘ä»¬æ¯å‘¨éƒ½ä¼šä¸ºå¤§å®¶è¾“å‡º**å¥½ç©ã€æœ‰è¶£ã€ç¬¦åˆå‰ç«¯å‘å±•**çš„æŠ€æœ¯å‹æ–‡ç« ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä¸€èµ·å­¦ä¹ è¿›æ­¥ğŸ’ªã€‚å¦‚æœè§‰å¾—æŸä½å°å“¥å“¥/å°å§å§å†™çš„ä¸é”™çš„è¯ï¼Œè¿˜è¯·ä¸è¦åå•¬ä½ çš„èµğŸ‘å“¦ï¼Œæ¯ä¸ªèµå’Œè¯„è®ºéƒ½æ˜¯å¯¹æˆ‘ä»¬æœ€å¥½çš„æ”¯æŒğŸ˜Šï¼Œæ„Ÿè°¢ã€‚

åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œå‘†å‘†å†’æ­»å›ç­”ä¸€ä¸‹æ ‡é¢˜çš„é—®é¢˜å§...æ˜¯çš„ï¼å®ƒå¾ˆé«˜çº§ğŸ˜…ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21a1c13e8da34c0083e8304612cf910a~tplv-k3u1fbpfcp-zoom-1.image)

æˆ‘ä¹Ÿè°ƒç ”äº†å¾ˆå¤šå…³äºHOCçš„èµ„æ–™ï¼Œå…¶ä¸­ç¡®å®ä¹Ÿæœ‰å¾ˆå¤šå†™çš„æ¯”è¾ƒå¥½çš„æ–‡ç« ã€‚ä½†å¦‚æœä½ æƒ³é—®æœ¬ç¯‡æ–‡ç« çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿå””...æˆ‘å¯ä»¥æ–—èƒ†çš„è¯´ï¼Œä¼šæ›´åŠ è¯¦ç»†ï¼Œæ¡ˆä¾‹ä¹Ÿä¼šæ›´åŠ é½å…¨ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘ä¼šä»HOCæ˜¯ä»€ä¹ˆã€æ€ä¹ˆç”¨å®ƒã€ç”¨å®ƒéœ€è¦æ³¨æ„ä»€ä¹ˆç­‰æ–¹é¢è¯¦ç»†çš„å»è®²è§£ï¼Œå°½é‡è®©å¤§å®¶éƒ½èƒ½ç†è§£ã€‚

**é€‚å®œäººç¾¤**ï¼šèƒ½çœ‹å¾—æ‡‚ä¸€äº›`React`çš„é“ä»”ã€é“å¦¹ğŸ˜Šã€‚

æ¥çœ‹çœ‹é€šè¿‡é˜…è¯»æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å¯ä»¥å­¦ä¹ åˆ°ï¼š

- HOCçš„æ¦‚å¿µ
- å¦‚ä½•å®ç°é«˜é˜¶ç»„ä»¶
- HOCçš„å‡ ç§ä½¿ç”¨æ–¹å¼
- HOCçš„å®é™…ç”¨æ³•
- ä½¿ç”¨HOCéœ€è¦æ³¨æ„çš„ç‚¹



## 1. HOCçš„æ¦‚å¿µ

å…¶å®å¦‚æœæœ‰è¿‡`React`å¼€å‘ç»éªŒçš„å°ä¼™ä¼´å¯¹`HOC`çš„æ¦‚å¿µåº”è¯¥å°±ä¸é™Œç”Ÿäº†ï¼Œä¸è¿‡æ—¢ç„¶æ˜¯ä»‹ç»å®ƒçš„è¯ï¼Œé‚£å‘†å‘†ä¹Ÿç¨å¾®æ­£å¼ä¸€ç‚¹ï¼š

`HOC`ï¼Œå…¨ç§°`Higher-Order Components`ï¼Œå³é«˜é˜¶ç»„ä»¶ã€‚

å®ƒçš„æ¦‚å¿µåº”è¯¥æ˜¯æ¥æºäº`JavaScript`çš„é«˜é˜¶å‡½æ•°ï¼Œæˆ‘ä»¬çŸ¥é“é«˜é˜¶å‡½æ•°å°±æ˜¯æ¥å—å‡½æ•°ä½œä¸ºè¾“å…¥æˆ–è€…è¾“å‡ºçš„å‡½æ•°ã€‚

é€šä¿—æ¥è¯´å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ğŸ˜„ï¼Œè¿™æ ·çš„å‡½æ•°å°±è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ã€‚

ä¾‹å¦‚ğŸŒ°ä¸‹é¢çš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼š

```javascript
// 1. å‚æ•°ä¸ºå‡½æ•°
const test1 = fn => {
  setTimeout(() => fn(), 1000)
};
const log1 = () => console.log('æˆ‘çˆ±å­¦ä¹ ');
test1(log1); // 1såæ‰“å°

// 2. è¿”å›å€¼ä¸ºå‡½æ•°
const test2 = () => {
  const log2 = name => console.log(name);
  return log2;
}
test2()('å­¦ä¹ ä¸çˆ±æˆ‘'); // ç«‹å³æ‰“å°
```

é‚£ä¹ˆå…¶å®ï¼Œ**é«˜é˜¶ç»„ä»¶å®ƒä¹Ÿä»…ä»…åªæ˜¯ä¸€ä¸ªæ¥å—ç»„ä»¶ä½œä¸ºè¾“å…¥å¹¶è¿”å›ç»„ä»¶çš„å‡½æ•°**ã€‚å‘†å‘†è®¤ä¸ºå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„APIæˆ–è€…ä¸€ä¸ªæ–°çš„ä»€ä¹ˆç©æ„ï¼Œä»…ä»…æ˜¯ä¸€ç§æ¨¡å¼å§ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§æŠ€å·§ï¼Œè¿™ç§æŠ€å·§èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬**å¤ç”¨ç»„ä»¶é€»è¾‘**ã€‚

å°±åƒä¸‹é¢ğŸ‘‡è¿™æ ·çš„ç”¨æ³•ï¼š

è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª*FinalComponent.js*

```javascript
import React from 'react';

function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      return <WrappedComponent />;
    }
  }
}
class TestComponent extends React.Component {
  render () {
    return (
      <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šçš„ç»„ä»¶</div>
    )
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘åšäº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š

- åˆ›å»ºäº†ä¸€ä¸ªåä¸º`MyHOC`çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåä¸º`WrappedComponent`çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åŒ¿åç»„ä»¶
- è¿™ä¸ªåŒ¿åç»„ä»¶çš„`render`è¿”å›çš„æ˜¯ä¼ é€’è¿›æ¥çš„`WrappedComponent`ç»„ä»¶
- ä¹‹ååˆ›å»ºäº†ä¸€ä¸ªåä¸º`TestComponent`çš„ç»„ä»¶
- å†è°ƒç”¨`MyHOC`å‡½æ•°å¹¶æŠŠ`TestComponent`ä¼ é€’è¿›å»èµ‹å€¼ç»™`FinalComponent`å˜é‡
- æ­¤æ—¶çš„`FinalComponent`å…¶å®å°±æ˜¯é‚£ä¸ªåŒ¿åç»„ä»¶ï¼Œæˆ‘ä»¬å°†å®ƒå¯¼å‡ºã€‚

 åœ¨å…¶å®ƒåœ°æ–¹ä½¿ç”¨`FinalComponent`è¿™ä¸ªç»„ä»¶çš„è¯ï¼Œå°±èƒ½æ­£å¸¸æ¸²æŸ“å‡º`"æˆ‘å°±æ˜¯ä¸ªæ™®é€šçš„ç»„ä»¶"`äº†ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢ğŸ‘†çš„è¿™ç§ç”¨æ³•å…¶å®å°±å«é«˜é˜¶ç»„ä»¶ï¼Œå®ƒé¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚

å¤§å®¶è¦æ³¨æ„è¿™é‡Œçš„å‘½åå“Ÿï¼Œ`MyHOC`å‡½æ•°çš„å‚æ•°å¿…é¡»å¤§å†™å¼€å¤´çš„ï¼Œå› ä¸ºåé¢éœ€è¦æŠŠå®ƒå½“æˆç»„ä»¶æ¥è¿”å›ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨`React`ä¸­å¦‚æœæ˜¯ç»„ä»¶çš„è¯ï¼Œå®ƒçš„å‘½åå¼€å¤´å¿…é¡»æ˜¯è¦å¤§å†™ï¼Œ`React`ä¼šå°†å°å†™å¼€å¤´çš„ç»„ä»¶å½“æˆæ™®é€šçš„`HTML`æ ‡ç­¾å¤„ç†ï¼Œè¿™æ ·å°±ä¼šæŠ¥é”™ã€‚

(å¦å¤–è¿˜æœ‰ä¸€ç‚¹ï¼Œ`HOC`å¹¶ä¸æ˜¯`React`é‡Œç‹¬æœ‰çš„ï¼Œå…¶å®ƒæ¡†æ¶ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚æ™¨æ›¦è€å“¥çš„è¿™ç¯‡æ–‡ç« å°±ä»‹ç»äº†å®ƒåœ¨`Vue`ä¸­çš„ç”¨æ³•ï¼š[Vue è¿›é˜¶å¿…å­¦ä¹‹é«˜é˜¶ç»„ä»¶ HOC](https://juejin.im/post/5e8b5fa6f265da47ff7cc139))



å¥½çš„ï¼Œæ—¢ç„¶åœ¨ä¸Šé¢è°ˆåˆ°äº†**é«˜é˜¶ç»„ä»¶**ä¸»è¦æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬**å¤ç”¨ç»„ä»¶é€»è¾‘**ï¼Œé‚£å¤§å®¶ä¼šä¸ä¼šæƒ³åˆ°å¦ä¸€ä¸ªå«`Mixin`çš„ä¸œè¥¿å‘¢ï¼Ÿä½†æ˜¯å› ä¸º`ES6`æœ¬èº«æ˜¯ä¸åŒ…å«ä»»ä½•`Mixin`æ”¯æŒçš„ï¼Œæ‰€ä»¥å½“ä½ åœ¨`React`ä¸­ä½¿ç”¨`ES6 class`æ—¶ï¼Œå°†ä¸æ”¯æŒ`Mixin `ï¼Œè€Œä¸”ä½¿ç”¨å®ƒæœ¬èº«ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œç°åœ¨ä¹Ÿæ˜¯ä¸æ¨èä½¿ç”¨äº†ã€‚

å‘†å‘†ï¼Œæ—¢ç„¶ä½ æŠŠé«˜é˜¶ç»„ä»¶å¹çš„è¿™ä¹ˆç‰›ï¼Œé‚£å®ƒå…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ

å’¦ï½è¿™ä¹ˆç€æ€¥å¹²å˜›ï¼Ÿå“ˆå“ˆå“ˆå“ˆï¼Œå’±æ¥ç€å¾€ä¸‹çœ‹ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d50e27e180ab433ab50f572369b600cb~tplv-k3u1fbpfcp-zoom-1.image)



## 2. å¦‚ä½•å®ç°é«˜é˜¶ç»„ä»¶

### 2.1 å±æ€§ä»£ç†

å…¶å®åœ¨ä¸Šé¢ğŸ‘†å‘†å‘†å·²ç»å‘å¤§å®¶å±•ç¤ºäº†é«˜é˜¶ç»„ä»¶çš„åŸºæœ¬ç”¨æ³•ï¼Œè®©æˆ‘ä»¬æ¥ç®€å•å›é¡¾ä¸€ä¸‹å‰é¢æ˜¯æ€ä¹ˆåšçš„ï¼š

```javascript
import React from 'react';

function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      return <WrappedComponent />;
    }
  }
}
class TestComponent extends React.Component {
  render () {
    return (
      <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šçš„ç»„ä»¶</div>
    )
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

å®šä¹‰ä¸€ä¸ªå‡½æ•°(`MyHOC`)ä¸”æ¥æ”¶ä¸€ä¸ªç»„ä»¶ï¼Œä¹‹åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚

é‚£å¤§å®¶è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ­¤æ—¶æˆ‘åœ¨é¡µé¢ä¸­å¼•ç”¨äº†`FinalComponent`ç»„ä»¶ï¼Œå¹¶ä¸”éœ€è¦å‘`TestComponent`ä¼ é€’ä¸€äº›å±æ€§ï¼Œä¹Ÿå°±æ˜¯`props`ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

```js
<FinalComponent id={1} />
```

é€šè¿‡è¿™æ ·ä¼ é€’çš„`id`è™½ç„¶ä¸èƒ½ç›´æ¥è¢«`TestComponent`ç»„ä»¶ç»™æ‹¿åˆ°ï¼Œä½†æ˜¯å´å¯ä»¥åœ¨`MyHOC`ä¸­æ‹¿åˆ°ï¼Œå› ä¸ºæ­¤æ—¶`FinalComponent`ç¡®å®å°±æ˜¯`MyHOC`å‡½æ•°ä¸­å¯¼å‡ºçš„é‚£ä¸ªåŒ¿åç»„ä»¶ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`this`æ¥è®¿é—®åˆ°è¿™ä¸ªåŒ¿åç»„ä»¶çš„ä¸€äº›å±æ€§ï¼ŒåŒ…æ‹¬ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ—¶ä¼ é€’çš„ä¸€äº›`props`ï¼š

```js
function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      console.log(this.props); // { id: 1 }
      return <WrappedComponent />;
    }
  }
}
```

å¥½çš„ğŸ‘Œï¼æˆ‘ä»¬å·²ç»æˆåŠŸæ‹¿åˆ°è°ƒç”¨`FinalComponent`æ—¶ä¼ é€’çš„`props`ï¼Œæ¥ä¸‹é‡Œéœ€è¦æŠŠå®ƒä¼ é€’ç»™`WrappedComponent`ï¼Œè¿™å°±å¾ˆç®€å•äº†ï¼Œåªéœ€è¦ä½¿ç”¨`ES6`çš„å¯¹è±¡å±•å¼€æ“ä½œç¬¦å³å¯å®ç°ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·ï¼š

```js
function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      console.log(this.props); // ä¸€ã€{ id: 1 }
      return <WrappedComponent {...this.props} />;
    }
  }
}
class TestComponent extends React.Component {
  render () {
    return (
      console.log(this.props); // äºŒã€åœ¨è¿™é‡Œèƒ½æ‹¿åˆ°
      <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šçš„ç»„ä»¶</div>
    )
  }
}
```

è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯ä¸€ä¸ªæµ…æ‹·è´çš„è¿‡ç¨‹ï¼Œå¦‚æœ`this.props`æœ‰å¤šä¸ªå±æ€§çš„è¯ï¼Œéƒ½ä¼šå°†å…¶å±•å¼€ä¼ é€’ç»™`WrappedComponent`ï¼š

```js
console.log(this.props); // { id: 1, uid: 123 }

<WrappedComponent {...this.props} />
// ç­‰ä»·äº =>
<WrappedComponent id={1} uid={123} />
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨`WrappedComponent`ç»„ä»¶çš„æ—¶å€™ï¼Œéƒ½å¿…ç„¶è¦ç»è¿‡`MyHOC`å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´`MyHOC`æˆäº†`WrappedComponent`çš„`"ä»£ç†"`ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥å¯¹åœ¨è¿™ä¸€å±‚åšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚æ“ä½œå‰é¢æåˆ°çš„`this.props`ï¼Œæˆ–è€…æ˜¯`WrappedComponent`çš„é™æ€å±æ€§æ–¹æ³•ã€‚

åƒè¿™ç§**å‡½æ•°è¿”å›ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç»„ä»¶ï¼Œç„¶ååœ¨`render`ä¸­è¿”å›è¦åŒ…è£¹çš„ç»„ä»¶ï¼ŒåŒæ—¶åœ¨å‡½æ•°ä¸­åšä¸€äº›é¢å¤–å¤„ç†çš„æ–¹å¼**ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º**å±æ€§ä»£ç†**ï¼Œæ ¹æ®å®ƒçš„åŠŸèƒ½æ¥çœ‹è¿™ä¸ªåå­—æ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£å‘¢ï¼ŸğŸ˜Šã€‚

ä¸€èµ·æ¥çœ‹ä¸ªç®€å†™ï¼š

```javascript
function proxyHOC(WrappedComponent) {
  return class extends Component {
    render() {
      return <WrappedComponent {...this.props} />;
    }
  }
}
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b48745b7b22e4e73918fd46b2731f16d~tplv-k3u1fbpfcp-zoom-1.image)

å¥½çš„ğŸ‘Œï¼Œå‘†å‘†æ—¢ç„¶å·²ç»å‘Šè¯‰äº†ä½ ä»¬è¿™ç§å…¨æ–°çš„ä½¿ç”¨æ–¹å¼äº†ï¼Œé‚£ä½ èƒ½æƒ³åˆ°é€šè¿‡è¿™ç§åä¸º`"å±æ€§ä»£ç†"`çš„ä¸œè¥¿èƒ½è®©æˆ‘ä»¬åšå“ªäº›å¥½ç©æœ‰è¶£çš„äº‹å—ï¼Ÿ

é¦–å…ˆç¬¬ä¸€ç‚¹å‘†å‘†æ¥ç»™ä½ èµ·ä¸ªå¤´ï¼šåœ¨æˆ‘ä»¬å®šä¹‰çš„é«˜çº§ç»„ä»¶çš„é‚£ä¸ªå‡½æ•°ä¸­ï¼Œæ˜¯å¯ä»¥å¯¹è¦è¿”å›çš„ç»„ä»¶çš„å±æ€§è¿›è¡ŒäºŒæ¬¡åŠ å·¥çš„ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥ç»™`this.props`æ·»åŠ ä¸Šä¸€äº›æ–°çš„å±æ€§ï¼Œå¹¶ä¼ é€’ç»™`WrappedComponent`ï¼ŸOKğŸ‘Œï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹`"å±æ€§ä»£ç†"`å®ƒçš„ç¬¬ä¸€ç§ç”¨æ³•ã€‚



#### 2.1.1 æ“ä½œpropsæ·»åŠ å…¬å…±å±æ€§

å°±åƒä¸Šé¢ğŸ‘†è¯´çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»™`this.props`æ·»åŠ ä¸Šä¸€äº›æ–°çš„å±æ€§å¹¶å‘ä¸‹ä¼ é€’ï¼Œä½†æ˜¯è¿™ä¸ªæ·»åŠ ä¸æ˜¯è®©ä½ å»ç›´æ¥ä¿®æ”¹`this.props`å“ˆï¼Œæ¯”å¦‚ä¸‹é¢ğŸ‘‡è¿™ç§ç”¨æ³•è‚¯å®šå°±æ˜¯ä¸è¡Œçš„äº†ï¼š

```javascript
render () {
 this.props.remark = 'åˆ«è‡ªé—­'
 return <WrappedComponent {...this.props} />
}
```

å› ä¸º`React`æ˜¯å•å‘æ•°æ®æµï¼Œå®ƒä¸å…è®¸ä½ å»ä¿®æ”¹`props`ï¼Œæ­¤æ—¶ä½ ä¼šå‘ç°æ§åˆ¶å°ç›´æ¥å°±æŠ¥é”™äº†ï¼š

```
HOC21.jsx:10 Uncaught TypeError: Cannot add property remark, object is not extensible
```

é‚£å¥½çš„ï¼Œæˆ‘æ–°å»ºä¸€ä¸ªå¯¹è±¡å†æ·»åŠ é¢å¤–å±æ€§å°±ä¸è¡Œäº†ğŸ˜„ï¼Ÿæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠå‰é¢çš„æ¡ˆä¾‹æ”¹é€ ä¸€ä¸‹ï¼Œè¿™æ ·åšï¼š

```javascript
import React from 'react';

function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      const newProps = { // é‡ç‚¹çœ‹è¿™é‡Œ
        ...this.props,
        remark: 'åˆ«è‡ªé—­'
      }
      return <WrappedComponent {...newProps} />
    }
  }
}

class TestComponent extends React.Component {
  render () {
    console.log(this.props) // { id: 1, remark: 'åˆ«è‡ªé—­' }
    return <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šdiv</div>
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

ä½¿ç”¨ï¼š

```html
<FinalComponent id={1} />
```

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶`FinalComponent`æˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™åªä¼ é€’äº†ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå°±æ˜¯`id`ï¼Œä½†æ˜¯æœ€ç»ˆ`TestComponent`ç»„ä»¶æ¥æ”¶åˆ°çš„`props`å´ç»è¿‡`MyHOC`æ·»åŠ ä¸Šäº†é¢å¤–çš„å±æ€§`"è‡ªé—­"`ï¼Œå‘¸ï¼Œæ˜¯`"åˆ«è‡ªé—­"`ã€‚

è¿™æ ·å°±è¾¾åˆ°äº†åœ¨è°ƒç”¨`TestComponent`çš„æ—¶å€™ï¼Œå¯ä»¥é¢å¤–æ–°åŠ ä¸€äº›å±æ€§çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ç°åœ¨å¦‚æœæˆ‘ä»¬æœ‰å¥½å‡ ä¸ªç»„ä»¶ï¼Œéƒ½éœ€è¦æ·»åŠ ä¸€äº›ç›¸åŒçš„å±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯åªéœ€è¦å®šä¹‰å¥½ä¸€ä¸ª`MyHOC`ï¼Œç„¶åè®©è¿™äº›ç»„ä»¶éƒ½ç»è¿‡`MyHOC`è¿‡ä¸€éå°±å¯ä»¥äº†ã€‚

`Good boy!`ç°åœ¨æˆ‘ä»¬å·²ç»ä¼š`"å±æ€§ä»£ç†"`çš„å…¶ä¸­ä¸€ç§ç”¨æ³•äº†ï¼Œä¸è¯´äº†ï¼Œå­¦ç´¯äº†ï¼Œå–å£æ°´å»ï¼Œé¡ºä¾¿æƒ³æƒ³è¿˜å¯ä»¥æ€æ ·ç”¨ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91de52d1198c4b70b58ba776fd1eee61~tplv-k3u1fbpfcp-zoom-1.image)

#### 2.1.2 ç»„åˆæ¸²æŸ“

å””ï¼Œæ¬¢è¿å›æ¥å‘€ã€‚å°±åœ¨åˆšåˆšçœ‹è¡¨æƒ…åŒ…çš„æ—¶é—´ï¼Œå¤§å®¶æœ‰æƒ³åˆ°ä»€ä¹ˆå…¶å®ƒçš„ç”¨æ³•ä¸ï¼Ÿ

æ²¡æœ‰ï¼Ÿå¥½å§ã€‚å’³å’³ï¼Œå‘†å‘†å¯æ˜¯æƒ³åˆ°äº†ğŸ˜…ã€‚å…¶å®å¤§å®¶å¯ä»¥è¿™æ ·å»æƒ³ï¼Œä¸€ä¸ª`React`ç»„ä»¶é‡Œï¼Œæ— éå°±æ˜¯è¿™å‡ ç§ä¸œè¥¿ï¼ŒåƒåŸºç¡€ç‚¹çš„æœ‰ä»€ä¹ˆ`propsã€stateã€ç”Ÿå‘½å‘¨æœŸã€renderå‡½æ•°`å•¦ï¼Œå†é«˜çº§ç‚¹çš„å¯èƒ½å°±æ˜¯`refs`ã€‚æ—¢ç„¶è¿™æ ·çš„è¯ï¼Œå’±æŠŠè¿™å‡ ä¸ªéƒ½å¥—ä¸Šå»è¯•è¯•ï¼Œçœ‹æ˜¯ä¸æ˜¯èƒ½äº§ç”Ÿå¾ˆå¤šæ–°é²œçš„ç”¨æ³•å‘¢ã€‚

å°±æ¯”å¦‚`renderå‡½æ•°`å§ï¼Œæ—¢ç„¶å‰é¢çš„`props`æ˜¯åœ¨æ•°æ®ä¼ é€’çš„å±‚é¢åšä¸€äº›äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»æ¸²æŸ“å±‚å»çœ‹çœ‹ã€‚

æ¯”å¦‚ç»™æœ€ç»ˆè¾“å‡ºçš„`UI`å†æ·»åŠ ä¸€äº›é¢å¤–çš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å¯ä»¥æ˜¯`HTML`å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯`React`ç»„ä»¶ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç»™ä¸Šé¢çš„æ¡ˆä¾‹å¢åŠ ä¸€ä¸ª`HTML`å…ƒç´ ï¼š

```diff
import React from 'react';
function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
+      return (<>
+        <div>æˆ‘æ˜¯é¢å¤–æ·»åŠ çš„HTMLå…ƒç´ </div>
+        <WrappedComponent {...this.props} />
+      </>)
    }
  }
}
class TestComponent extends React.Component {
  render () {
    console.log(this.props)
    return <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šdiv</div>
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

å¢åŠ `React`ç»„ä»¶ä¹Ÿå¯ä»¥ï¼š

```diff
import React from 'react';
+ function ExtraComponent () {
+  return (
+    <div>æˆ‘æ˜¯é¢å¤–æ·»åŠ çš„Reactç»„ä»¶</div>
+  )
+ }
function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      return (<>
        <div>æˆ‘æ˜¯é¢å¤–æ·»åŠ çš„HTMLå…ƒç´ </div>
+       { ExtraComponent() }
        <WrappedComponent {...this.props} />
      </>)
    }
  }
}
class TestComponent extends React.Component {
  render () {
    console.log(this.props)
    return <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šdiv</div>
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

(é¢ï¼Œå…³äº`<></>`å¤§å®¶åº”è¯¥çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€å§ï¼Œå…¶å®å°±æ˜¯`React.Fragment`çš„ç®€å†™ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå°±æ˜¯ä¸€ä¸ªé€æ˜çš„`div`ï¼Œä½†æ˜¯å¹¶ä¸ä¼šåœ¨é¡µé¢ä¸Šæ¸²æŸ“å‡ºè¿™ä¸ª`div`ï¼Œç”¨è¿‡`Vue`çš„å°ä¼™ä¼´å¯èƒ½å¥½ç†è§£ä¸€äº›ï¼Œå°±æ˜¯ç±»ä¼¼`Vue`ä¸­çš„`template`æ ‡ç­¾)

åƒä¸Šé¢ğŸ‘†çš„è¿™ç§å®ç°æ–¹å¼æˆ‘ä»¬ä¹Ÿæ¥ç»™å®ƒå–ä¸ªåå­—å§â€”â€”`ç»„åˆæ¸²æŸ“`ã€‚

å’Œå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒå¯ä»¥å¯¹æˆ‘ä»¬æœ€ç»ˆè¦æ¸²æŸ“çš„`UI`åšä¸€äº›ç»„åˆï¼Œä¸ç®¡è¿™ç§ç»„åˆæ˜¯åŒ…è£¹çš„ï¼Œè¿˜æ˜¯å…„å¼Ÿä¹‹é—´çš„ç»„åˆï¼Œéƒ½å¯ä»¥ã€‚æ€ä¹ˆæ ·ï¼Ÿå°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰å†…å‘³äº†ï¼ŸğŸ˜

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c86de3f3b7b04297ad4f33c4e8695304~tplv-k3u1fbpfcp-zoom-1.image)



#### 2.1.3 æ¡ä»¶æ¸²æŸ“

å…¶å®æœ‰äº†**ç»„åˆæ¸²æŸ“**ï¼Œæ¡ä»¶æ¸²æŸ“è¿™ç§ç”¨æ³•æˆ‘ä»¬ä¹Ÿå¾ˆå¥½ç†è§£äº†ï¼Œç”šè‡³æˆ‘åœ¨å¬åˆ°è¿™ä¸ªè¯çš„æ—¶å€™ï¼Œè„‘å­é‡Œå·²ç„¶èƒ½æƒ³åˆ°å¯ä»¥æ€ä¹ˆå»åšäº†ã€‚

æœ€ç®€å•çš„ä¸€ç§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦åˆ¤æ–­ç»„ä»¶æ˜¯å¦æ¸²æŸ“ï¼š

```diff
import React from 'react';
+ function ReboundGuy () {
+  return (
+    <div>æˆ‘åªæ˜¯ä¸ªå¤‡èƒ...</div>
+  )
+ }
function MyHOC (WrappedComponent) {
  return class extends React.Component {
    render () {
      return (<>
+        {
+          this.props.flag ? <WrappedComponent {...this.props} /> :
+          ReboundGuy()
+        }
      </>)
    }
  }
}
class TestComponent extends React.Component {
  render () {
    console.log(this.props)
    return <div>æˆ‘å°±æ˜¯ä¸ªæ™®é€šdiv</div>
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

é€šè¿‡åˆ¤æ–­ä¼ é€’è¿›æ¥çš„`flag`çš„å€¼æ¥å†³å®šæ¸²æŸ“å‡ºä»€ä¹ˆå†…å®¹ï¼Œç»“åˆå®é™…åº”ç”¨æ¥è¯´ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æŠŠä¸Šé¢ğŸ‘†çš„`"å¤‡èƒ"`ç»„ä»¶æ¢æˆä¸€ä¸ª`Loading`ç»„ä»¶å‘¢ï¼Ÿ

å…¶å®å¤§å®¶å¯ä»¥å‘ç°ï¼Œè¿™äº›ç”¨æ³•å¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆéš¾ã€‚å¯èƒ½ä¹Ÿæœ‰å°ä¼™ä¼´ä¼šé—®äº†ï¼Œå¦‚æœåªæ˜¯æƒ³è¦å®ç°ä¸€ä¸ªè¿™æ ·çš„æ¡ä»¶æ¸²æŸ“ï¼Œæˆ‘ä¸ç”¨é«˜çº§ç»„ä»¶ï¼Œå†™åœ¨æ¯ä¸ªç»„ä»¶é‡Œä¹Ÿå¯ä»¥å®ç°å‘€ã€‚

æ²¡é”™ï¼Œæ˜¯æœ‰å¾ˆå¤šçš„åŠæ³•å¯ä»¥å®ç°ï¼Œå‘†å‘†ä¹Ÿæ²¡è¯´éå¾—ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œåªä¸è¿‡è¿™ç¡®å®æ˜¯æˆ‘ä»¬å®ç°åŠŸèƒ½çš„ä¸€ç§æ–¹å¼ã€‚



#### 2.1.4 çŠ¶æ€ç®¡ç†(æŠ½è±¡state)

è¿˜æœ‰ä¸€ç§ç”¨æ³•è¢«ç§°ä¹‹ä¸º`çŠ¶æ€ç®¡ç†`ï¼Œæœ‰çš„æ•™æé‡Œä¹Ÿå«åš`æŠ½è±¡state`ã€‚åˆšå¼€å§‹å¬åˆ°è¿™ä¸ªè¯å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œä¸è¿‡å¦‚æœå¤§å®¶çŸ¥é“å®ƒæ˜¯æ€æ ·ç”¨çš„è¯è¯»æ‡‚è¿™ä¸ªå‘½åå°±å¾ˆç®€å•äº†ã€‚

åœ¨`React`ä¸­æ˜¯ä¼šæœ‰ä¸€ä¸ªå«åšå—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶çš„æ¦‚å¿µçš„(å¦‚æœè¿˜ä¸æ¸…æ¥šçš„å°ä¼™ä¼´å¯å¾—çœ‹çœ‹è¿™ç¯‡æ–‡ç« äº†[ã€Šå—æ§å’Œéå—æ§ç»„ä»¶çœŸçš„é‚£ä¹ˆéš¾ç†è§£å—ï¼Ÿ(Reactå®é™…æ¡ˆä¾‹è¯¦è§£)ã€‹](https://juejin.im/post/6858276396968951822))ã€‚

æ€»ç»“æ¥è¯´ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬**å¯¹æŸä¸ªç»„ä»¶çŠ¶æ€çš„æŒæ§ï¼Œå®ƒçš„å€¼æ˜¯å¦åªèƒ½ç”±ç”¨æˆ·è®¾ç½®ï¼Œè€Œä¸èƒ½é€šè¿‡ä»£ç æ§åˆ¶**ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨`React`ä¸­å®šä¹‰äº†ä¸€ä¸ª`input`è¾“å…¥æ¡†çš„è¯ï¼Œå®ƒå¹¶æ²¡æœ‰ç±»ä¼¼äº`Vue`é‡Œ`v-model`çš„è¿™ç§åŒå‘ç»‘å®šåŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸€ä¸ªæŒ‡ä»¤èƒ½å¤Ÿå°†æ•°æ®å’Œè¾“å…¥æ¡†ç»“åˆèµ·æ¥ï¼Œç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œç„¶åæ•°æ®åŒæ­¥æ›´æ–°ã€‚

å°±åƒä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹ï¼š

```jsx
class TestComponent extends React.Component {
  render () {
    return <input name="username" />
  }
}
```

ç”¨æˆ·åœ¨ç•Œé¢ä¸Šçš„è¾“å…¥æ¡†è¾“å…¥å†…å®¹æ—¶ï¼Œå®ƒæ˜¯è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ª`"state"`ï¼Œè¿™æ ·çš„è¯å°±èƒ½æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è‡ªå·±è¿›è¡Œ`UI`ä¸Šçš„æ›´æ–°ã€‚(è¿™ä¸ª`state`å¹¶ä¸æ˜¯æˆ‘ä»¬å¹³å¸¸çœ‹è§çš„`this.state`ï¼Œè€Œæ˜¯æ¯ä¸ªè¡¨å•å…ƒç´ ä¸ŠæŠ½è±¡çš„`state`)

æƒ³æƒ³æ­¤æ—¶å¦‚æœæˆ‘ä»¬æƒ³è¦æ§åˆ¶è¾“å…¥æ¡†çš„å†…å®¹å¯ä»¥æ€æ ·åšå‘¢ï¼Ÿå””...è¾“å…¥æ¡†çš„å†…å®¹å–å†³çš„æ˜¯`input`ä¸­çš„`value`å±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨`this.state`ä¸­å®šä¹‰ä¸€ä¸ªåä¸º`username`çš„å±æ€§ï¼Œå¹¶å°†`input`ä¸Šçš„`value`æŒ‡å®šä¸ºè¿™ä¸ªå±æ€§ï¼š

```jsx
class TestComponent extends React.Component {
  constructor (props) {
    super(props);
    this.state = { username: 'lindaidai' };
  }
  render () {
    return <input name="username" value={this.state.username} />
  }
}
```

ä½†æ˜¯è¿™æ—¶å€™ä½ ä¼šå‘ç°`input`çš„å†…å®¹æ˜¯åªè¯»çš„ï¼Œå› ä¸º`value`ä¼šè¢«æˆ‘ä»¬çš„`this.state.username`æ‰€æ§åˆ¶ï¼Œå½“ç”¨æˆ·è¾“å…¥æ–°çš„å†…å®¹æ—¶ï¼Œ`this.state.username`å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™æ ·çš„è¯`input`å†…çš„å†…å®¹ä¹Ÿå°±ä¸ä¼šå˜äº†ã€‚

å“ˆå“ˆï¼Œä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª`onChange`äº‹ä»¶æ¥ç›‘å¬è¾“å…¥å†…å®¹çš„æ”¹å˜å¹¶ä½¿ç”¨`setState`æ›´æ–°`this.state.username`ï¼š

```jsx
class TestComponent extends React.Component {
  constructor (props) {
    super(props);
    this.state = {
      username: "lindaidai"
    }
  }
  onChange (e) {
    console.log(e.target.value);
    this.setState({
      username: e.target.value
    })
  }
  render () {
    return <input name="username" value={this.state.username} onChange={(e) => this.onChange(e)} />
  }
}
```

ç°åœ¨ä¸è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆå†…å®¹`state`ä¸`UI`éƒ½ä¼šè·Ÿç€æ›´æ–°äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­çš„å…¶å®ƒåœ°æ–¹ä½¿ç”¨`this.state.username`æ¥è·å–åˆ°`input`é‡Œçš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`this.setState()`æ¥ä¿®æ”¹`input`é‡Œçš„å†…å®¹ã€‚

é‚£ä¹ˆå¯¹äºä¸Šé¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª`HOC`å°†`state`ç»™æŠ½è±¡å‡ºæ¥ï¼Œå°±åƒä¸‹é¢ğŸ‘‡è¿™æ ·æ¥å†™ï¼š

```jsx
import React from 'react';

function MyHOC (WrappedComponent) { // å°†stateæŠ½è±¡åˆ°MyHOCä¸­
  return class extends React.Component {
    constructor (props) {
      super(props);
      this.state = {
        username: "lindaidai"
      }
      this.onChange= this.onChange.bind(this);
    }
    onChange (e) {
      console.log(e.target.value);
      this.setState({
        username: e.target.value
      })
    }
    render () {
      const newProps = {
        username: {
          value: this.state.username,
          onChange: this.onChange
        }
      }
      return <WrappedComponent {...this.props} {...newProps} />
    }
  }
}
class TestComponent extends React.Component {
  getUserName = () => { // å¯ä»¥åœ¨è¿™é‡Œæ‹¿åˆ°å€¼
    console.log(this.props.username.value)
  }
  render () {
    return <div>
      <input name="username" {...this.props.username} />
      <button onClick={() => this.getUserName()}>è·å–username</button>
    </div>
    // return <input name="username" value={this.state.username} onChange={(e) => this.onChange(e)} />
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°†åŸæœ¬åœ¨`TestComponent`ä¸­å®ç°å—æ§ç»„ä»¶çš„åŠŸèƒ½æå–å‡ºäº†åˆ°`MyHOC`ä¸­ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/046db3e0783942f9ab60e680dc7760ed~tplv-k3u1fbpfcp-zoom-1.image)


### 2.2 åå‘ç»§æ‰¿

OKğŸ‘Œï¼Œç›¸ä¿¡å¤§å®¶å¯¹**å±æ€§ä»£ç†**è¿™ç§æ–¹å¼çš„ä½¿ç”¨å·²ç»æŒæ¡çš„å·®ä¸å¤šäº†ã€‚é‚£ä¹ˆå¯¹äºé«˜é˜¶ç»„ä»¶ï¼Œè¿˜æœ‰å¦ä¸€ç§ç”¨æ³•ï¼Œä¹Ÿå¾ˆå±Œçš„æ ·å­ã€‚å””...ä¹Ÿå°±æ˜¯**åå‘ç»§æ‰¿**ã€‚

ä½•ä¸ºåå‘ç»§æ‰¿å‘¢ğŸ¤”ï¸ï¼ŸåŒæ ·çš„ï¼Œè¿˜æ˜¯ä¸€ä¸ªå‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œæ¥ç€è¿”å›äº†ä¸€ä¸ªç»§æ‰¿è‡³è¯¥ç»„ä»¶çš„ç±»ç»„ä»¶ï¼Œå¹¶ä¸”åœ¨è¿”å›ç»„ä»¶çš„`render`ä¸­ä½¿ç”¨`super.render()`æ–¹æ³•æ¸²æŸ“å‡ºä¼ å…¥çš„ç»„ä»¶ã€‚

å°±åƒæ˜¯ä¸‹é¢ğŸ‘‡è¿™ç§ç”¨æ³•ï¼Œå°±æ˜¯ä¸€ç§æœ€ç®€å•çš„åå‘ç»§æ‰¿ï¼š

```jsx
import React from 'react';

class TestComponent extends React.Component { // 1. å®šä¹‰äº†ä¸€ä¸ªç»„ä»¶
  render () {
    return <div>TestComponent</div>
  }
}
function MyHOC (WrappedComponent) { // 2. å®šä¹‰äº†ä¸€ä¸ªæ¥æ”¶ç»„ä»¶çš„å‡½æ•°
  return class extends WrappedComponent { // 3. è¿”å›äº†ä¸€ä¸ªç»§æ‰¿è‡³ä¼ å…¥ç»„ä»¶çš„åŒ¿åç±»ç»„ä»¶
    render () {
      return (
        {super.render()} // 4. æ­¤æ—¶çš„ super å®é™…å°±æ˜¯ä¼ å…¥çš„ç»„ä»¶çš„åŸå‹å¯¹è±¡, å¯ä»¥è°ƒç”¨å®ƒçš„ render()æ–¹æ³•è¿›è¡Œæ¸²æŸ“
      )
    }
  }
}
const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

åå‘ç»§æ‰¿ï¼Œæ‹†å¼€æ¥çœ‹ï¼šåå‘ã€ç»§æ‰¿ã€‚

å¦‚æœæŠŠåˆšåˆšç›´æ¥ä½¿ç”¨`WrappedComponent`çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯`<WrappedCompnent />`è¯´æˆæ˜¯æ­£å‘çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶`super.render()`ç¡®å®å¯ä»¥å½“æˆæ˜¯åå‘ï¼›è€Œç»§æ‰¿å°±å¾ˆå¥½ç†è§£äº†ï¼Œè¿”å›çš„åŒ¿åç±»ç»„ä»¶ç»§æ‰¿è‡³`WrappedComponent`ã€‚

æ‰€ä»¥ç›¸æ¯”è¾ƒäº**å±æ€§ä»£ç†**çš„æ–¹å¼ï¼Œ**åå‘ç»§æ‰¿**åˆæœ‰å®ƒè‡ªå·±çš„ç‰¹ç‚¹ï¼Œå› ä¸ºæ–°è¿”å›çš„åŒ¿åç»„ä»¶æ˜¯ç»§æ‰¿è‡³`WrappedComponent`çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥åœ¨åŒ¿åç»„ä»¶ä¸­ä½¿ç”¨`this`è®¿é—®åˆ°`WrappedComponent`çš„`state`äº†ï¼Œæˆ–è€…å…¶ä¸­çš„`ref`ã€‚å¦å¤–ï¼Œä¸€ä¸ªç»„ä»¶ä¸­è¿˜æœ‰å•¥ï¼Ÿå¯¹ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡åœ¨`WrappedComponent.prototype`ä¸­æ‹¿åˆ°å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚

å””ï¼Œå…³äºä¸Šé¢`super`çš„ç”¨æ³•æ˜¯å¦æœ‰å°ä¼™ä¼´è§‰å¾—æ¯”è¾ƒè¿·ç³Šçš„å‘¢ï¼Ÿé—®é¢˜ä¸å¤§ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢æœ‰å¯¹`class`ç»§æ‰¿çš„å…·ä½“æè¿°ï¼š[ã€Šã€ä½•ä¸ä¸‰è¿ã€‘åšå®Œè¿™48é“é¢˜å½»åº•å¼„æ‡‚JSç»§æ‰¿(1.7wå­—å«è¾›æ•´ç†-è¿”ç’å½’çœŸ)ã€‹](https://juejin.im/post/6844904098941108232#heading-41)ã€‚

å‘†å‘†è¿™é‡Œå¯ä»¥ç¨å¾®çš„åšä¸‹æ€»ç»“ï¼š

- åœ¨å®ç°ç»§æ‰¿æ—¶ï¼Œå¦‚æœå­ç±»ä¸­æœ‰`constructor`å‡½æ•°ï¼Œå¿…é¡»å¾—åœ¨`constructor`ä¸­è°ƒç”¨ä¸€ä¸‹`super`å‡½æ•°ï¼Œå› ä¸ºå®ƒå°±æ˜¯ç”¨æ¥äº§ç”Ÿå®ä¾‹`this`çš„ã€‚

- `super`æœ‰ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼šå½“æˆå‡½æ•°è°ƒç”¨å’Œå½“æˆå¯¹è±¡æ¥è°ƒç”¨ã€‚

- `super`å½“æˆå‡½æ•°è°ƒç”¨æ—¶ï¼Œä»£è¡¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä¸”è¿”å›çš„æ˜¯å­ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶`super`å†…éƒ¨çš„`this`æŒ‡å‘å­ç±»ã€‚åœ¨å­ç±»çš„`constructor`ä¸­`super()`å°±ç›¸å½“äºæ˜¯`Parent.constructor.call(this)`ã€‚

- `super`å½“æˆå¯¹è±¡è°ƒç”¨æ—¶ï¼Œæ™®é€šå‡½æ•°ä¸­`super`å¯¹è±¡æŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼Œé™æ€å‡½æ•°ä¸­æŒ‡å‘çˆ¶ç±»ã€‚ä¸”é€šè¿‡`super`è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œ`super`ä¼šç»‘å®šå­ç±»çš„`this`ï¼Œå°±ç›¸å½“äºæ˜¯`Parent.prototype.fn.call(this)`ã€‚

æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬èƒ½å¤ŸæˆåŠŸåœ¨åŒ¿åç±»å‡½æ•°ä¸­ä½¿ç”¨`super.render()`æ¸²æŸ“å‡º`WrappedComponent`ç»„ä»¶ã€‚



#### 2.2.1 æ“ä½œstate

æŒ‰ç…§ä¸Šé¢ğŸ‘†æ‰€è¯´çš„ï¼Œç”±äºè¿”å›çš„åŒ¿åç»„ä»¶ç»§æ‰¿è‡³`WrappedComponent`çš„ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥é€šè¿‡`this`è·å–åˆ°å®ƒçš„`state`ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ç§ä½¿ç”¨æ–¹å¼å“ˆã€‚

é¦–å…ˆæˆ‘å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰`state`å±æ€§çš„`TestComponent`ç»„ä»¶ï¼š

```jsx
class TestComponent extends React.Component {
  constructor (props) {
    super(props);
    this.state = {
      name: 'LinDaiDai'
    }
  }
  render () {
    return <div>TestComponent</div>
  }
}
```

æ¥ç€ä½¿ç”¨åå‘ç»§æ‰¿æ¥å®ç°ä¸€ä¸ª`HOC`å‡½æ•°ï¼š

```jsx
function MyHOC (WrapComponent) {
  return class extends WrapComponent { // é‡ç‚¹åœ¨è¿™é‡Œ
    constructor (props) {
      super(props);
      this.state = {
        sex: 'boy',
        ...this.state // ä½¿ç”¨ this.state è¯»å–åˆ° TestComponent ä¸­çš„ state
      }
    }
    changeState = () => {
      this.setState({
        sex: 'girl',
        name: 'daimei'
      })
    }
    getState = () => {
      console.log(this.state)
    }
    componentDidMount() {
      console.log(this.state.name)
    }
    render () {
      return (
        <div>
          <button onClick={() => this.changeState()}>æ”¹å˜state</button>
          <button onClick={() => this.getState()}>è·å–state</button>
        </div>
      )
    }
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åŒ¿åç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è®¿é—®åˆ°`TestComonent`ä¸­çš„`state`çš„ï¼Œä½†æ˜¯è¿™åŒæ ·ä¹Ÿæ˜¯ä¸€ä»¶å±é™©çš„äº‹æƒ…ã€‚å› ä¸ºè¿™ä¼šç›´æ¥å½±å“åˆ°`TestComponent`é‡Œçš„`state`ï¼Œå°±åƒåˆšåˆå§‹åŒ–åœ¨`constructor`å‡½æ•°ä¸­ï¼Œ`TestComponent`é‡Œçš„`state`å°±å·²ç»è¢«ä¿®æ”¹äº†ï¼š

ä»`{ name: 'LinDaiDai' }`å˜ä¸ºäº†`{ name: 'LinDaiDai', sex: 'boy' }`ã€‚

ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåŒ¿åç±»ç»„ä»¶å®ƒä¼šå’Œ`TestComponent`å…±ç”¨ä¸€ä¸ª`state`ã€‚

æ‰€ä»¥ä½ è¦æ˜¯ç‚¹å‡»`"æ”¹å˜state"`è¿™ä¸ªæŒ‰é’®çš„è¯ï¼Œ`state`éƒ½ä¼šå˜æˆ`{ name: 'daimei', sex: 'girl' }`ã€‚

è¿™åœ¨å®é™…å¼€å‘ä¸Šæ¥è¯´ï¼Œåº”è¯¥æ˜¯ä¸å¥½çš„ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½ä¸`TestComponent`ç»„ä»¶å†…éƒ¨åŸæœ¬çš„ä¸€äº›æ“ä½œæ„æˆå†²çªï¼Œå¹¶ä¸”å¯¹äº`state`çš„æ”¹å˜ä¹Ÿä¸èƒ½å¾ˆç›´è§‚çš„çœ‹åˆ°ã€‚



é‚£ä¹ˆå¯¹äºè¿™ç§æ–¹å¼ï¼Œåœ¨æˆ‘ä»¬å®é™…å¼€å‘ä¸­å¯ä»¥åšä»€ä¹ˆå‘¢ï¼Ÿ

å‘†å‘†æƒ³åˆ°äº†ä¸€ç§ç”¨æ³•ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªç”¨äº`debug`è°ƒè¯•çš„`HOC`å‡½æ•°ï¼š

```jsx
function debug(WrappedComponent) {
  return class extends WrappedComponent {
    render() {
      console.log(`${WrappedComponent.displayName}çš„props`, this.props);
      console.log(`${WrappedComponent.displayName}çš„state`, this.state);
      return (
        <div className="debug">
          {super.render()}
        </div>
      )
    }
  }
}
```

æ­¤æ—¶åªéœ€è¦åœ¨æƒ³è¦è°ƒè¯•çš„ç»„ä»¶ä¸Šï¼ŒåŠ ä¸Š`@debug`è£…é¥°å™¨å°±å¯ä»¥äº†ï¼Œè¿™æ ·å¯¹äºä¸€äº›æœ‰ç›¸åŒè°ƒè¯•ä»£ç çš„ç»„ä»¶æ¥è¯´ï¼Œè¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚



#### 2.2.2 æ¸²æŸ“åŠ«æŒ

è¿˜æœ‰ä¸€ç§ç”¨æ³•ï¼š**æ¸²æŸ“åŠ«æŒ**ã€‚å…ˆè®©æˆ‘ä»¬æŠŠä¸Šé¢ğŸ‘†è¯´çš„`super.render()`æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦å¯ä»¥å¯¹è¿™ä¸ªç©æ„åšä¸€äº›æ“ä½œå‘¢ï¼Ÿ

å¦‚ä¸‹æˆ‘æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„`Test`ç»„ä»¶ï¼š

```jsx
class TestComponent extends React.Component {
  render () {
    return <input value="LinDaiDai"></input>
  }
}
```

ç„¶åç”¨åå‘ç»§æ‰¿çš„æ–¹å¼æŠŠå®ƒæ‰“å°å‡ºæ¥ï¼š

```jsx
function MyHOC (WrapComponent) {
  return class extends WrapComponent {
    componentDidMount () {
      setTimeout(() => {
        console.log(this.props)
      }, 2000)
    }
    render () {
      let testRender = super.render();
      console.log(testRender);
      return testRender
    }
  }
}
```

æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

å›¾ç‰‡hoc1

äº†è§£è¿‡`React`åŸç†çš„å°ä¼™ä¼´åº”è¯¥éƒ½çŸ¥é“ï¼Œå¯¹äº`render`å‡½æ•°ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨`React.createElement()`ï¼Œç„¶åäº§ç”Ÿçš„`Reactå…ƒç´ `ã€‚è¿™ç‚¹å¯ä»¥ä»æ‰“å°çš„ç»“æœä¸­ï¼Œ`$$typeof` å±æ€§å­—æ®µæ˜¯ä¸æ˜¯ `Symbol('react.element')`æ¥åˆ¤æ–­ã€‚

æ‰€ä»¥å¯¹äº`super.render()`çš„ç»“æœï¼Œæ˜¯ä¸€ä¸ª`Reactå…ƒç´ `ï¼Œè¿™é‡Œé¢åŒ…å«äº†å¯¹`Test`ç»„ä»¶çš„ä¸€äº›æè¿°ï¼ŒåŒ…æ‹¬`refã€keyã€props`ç­‰ï¼Œé‚£ä¹ˆå¯¹äºè¿™äº›å±æ€§æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ“ä½œå—ï¼ŸOKğŸ‘Œï¼Œå’±ä¸å¦¨ä½¿ç”¨`getOwnPropertyDescriptors`æ¥å°†è¿™äº›å±æ€§çš„æè¿°æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼š

```diff
function MyHOC (WrapComponent) {
  return class extends WrapComponent {
    componentDidMount () {
      setTimeout(() => {
        console.log(this.props)
      }, 2000)
    }
    render () {
      let testRender = super.render();
      console.log(testRender);
+     console.log(Object.getOwnPropertyDescriptors(testRender));
      return testRender
    }
  }
}
```

æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

å›¾ç‰‡hoc2

å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™äº›å±æ€§çš„`writable`å…¨éƒ½æ˜¯`false`ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬å¹¶ä¸æ”¯æŒä¿®æ”¹ã€‚

å°±åƒæ˜¯æˆ‘æƒ³è¦ä¿®æ”¹ä¸€äº›è¾“å…¥æ¡†ä¸­çš„`value`å€¼ï¼š

```jsx
testRender.props.value = 'daimei';
```

å‘ç°å®ƒå¹¶ä¸èƒ½å¦‚æˆ‘æ‰€æ„¿ï¼Œæ§åˆ¶å°å‡ºç°äº†çº¢è‰²ï¼š

```
Uncaught TypeError: Cannot assign to read only property 'value' of object '#<Object>'
```

å•Šï¼Œè¿™å¯å°±æ˜¯æ–­äº†æˆ‘æƒ³è¦ç©å®ƒä»¬çš„æƒ³æ³•äº†...

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5abec6cb3c4444c19da739a9b62d1dc3~tplv-k3u1fbpfcp-zoom-1.image)

èªæ˜çš„æˆ‘çµæœºä¸€åŠ¨ğŸ’¡ï¼Œé‚£æ˜¯å¦å¯ä»¥ç”¨ä»€ä¹ˆå…‹éš†çš„æ–¹å¼æ¥å…‹éš†è¿™ä¸ªç»„ä»¶ï¼Œç„¶åå†è¿™ä¸ªåŸºç¡€ä¸Šå»ä¿®æ”¹æˆ‘ä»¬æƒ³è¦çš„å±æ€§ï¼Œäº¦æˆ–è€…æ·»åŠ ä¸Šä¸€äº›å±æ€§å‘¢ï¼Ÿ[å¥¸ç¬‘ï½]

å””ï¼Œå½“åˆè¯»`React`æ–‡æ¡£çš„æ—¶å€™ï¼Œè®°å¾—æœ‰ä¸€ä¸ªå«ä½œ`React.cloneElement`çš„ä¸œè¥¿ï¼Œçœ‹è¿™åå­—å¥½åƒå°±æ˜¯åšå…‹éš†ç”¨çš„å•Šï¼Œä¸‰ä¸‹äº”é™¤äºŒæ‰“å¼€æ–‡æ¡£ç…ç…å®ƒçš„ç”¨æ³•ï¼š

```jsx
React.cloneElement(
  element,
  [props],
  [...children]
)
```

å¥—ç”¨ä¸€ä¸‹å®˜æ–¹çš„è¯å“ˆï¼š

> ä»¥ `element` å…ƒç´ ä¸ºæ ·æ¿å…‹éš†å¹¶è¿”å›æ–°çš„ React å…ƒç´ ã€‚è¿”å›å…ƒç´ çš„ props æ˜¯å°†æ–°çš„ props ä¸åŸå§‹å…ƒç´ çš„ props æµ…å±‚åˆå¹¶åçš„ç»“æœã€‚æ–°çš„å­å…ƒç´ å°†å–ä»£ç°æœ‰çš„å­å…ƒç´ ï¼Œè€Œæ¥è‡ªåŸå§‹å…ƒç´ çš„ `key` å’Œ `ref` å°†è¢«ä¿ç•™ã€‚

è¿™å¥½åƒå°±æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæˆ‘å¯ä»¥è·å–åˆ°`testRender.props`ï¼Œç„¶åç»„åˆæˆä¸€ä¸ªæ–°çš„`props`å†ä½¿ç”¨`React.cloneElement`å»æ¸²æŸ“å‡ºä¸€ä¸ªæ–°çš„`Reactå…ƒç´ `ï¼Œè¯ä¸å¤šè¯´ï¼Œè¯•è¯•çœ‹ï¼š

```jsx
function MyHOC (WrapComponent) {
  return class extends WrapComponent {
    componentDidMount () {
      setTimeout(() => {
        console.log(this.props)
      }, 2000)
    }
    render () {
      let testRender = super.render();
      let newProps = { value: 'daimei' }
      let finalProps = Object.assign({}, testRender.props, newProps);
      let finalRender = React.cloneElement(
        testRender,
        finalProps,
        testRender.props.children
      );
      return finalRender
    }
  }
}
```

å•Šï¼Œé‡æ–°æ‰“å¼€é¡µé¢ï¼Œå‘ç°è¾“å…¥æ¡†å†…çš„`"LinDaiDai"`å·²ç»è¢«æˆåŠŸåŠ«æŒæˆ`"daimei"`äº†ï¼Œ`What a f..k`ğŸ’¥ã€‚



#### 2.2.3 åŠ«æŒç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

å””ï¼Œå…ˆæ¥è€ƒå¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼šä½ è®¤ä¸ºåœ¨å…¶ä»–ç»„ä»¶ä¸­å¯ä»¥æ€æ ·è·å–åˆ°å¦ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‘¢ï¼Ÿ

å¥½å§ï¼Œç»™ä½ ä»¬æ€è€ƒä¸€ä¸‹ğŸ˜„ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f6eded7b466485da9f9b830875273f0~tplv-k3u1fbpfcp-zoom-1.image)

è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»»ä½•å®šä¹‰çš„ï¼š

```jsx
class TestComponent extends React.Component {
  componentDidMount () {
    console.log('componentDidMount')
  }
  render () {
    return(
      <div>TestComponent</div>
    )
  }
}
```

å¯ä»¥å‘ç°ï¼Œä¸è®ºæ˜¯`componentDidMount`è¿˜æ˜¯`render`éƒ½æ˜¯å®šä¹‰åœ¨`TestComponent`ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ**åœ¨ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½å®šä¹‰åœ¨ç±»çš„`prototype`ä¸Š**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨å…¶å®ƒåœ°æ–¹è·å–åˆ°`TestComponent`çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°±å¾—åˆ°å®ƒçš„`prototype`ä¸Šå»æ‹¿ï¼Œå°±åƒè¿™æ ·ï¼š

```jsx
function MyHOC (WrappedComponent) {
  console.log(WrappedComponent.prototype.componentDidMount)
  console.log(WrappedComponent.prototype.render)
  return class extends WrappedComponent {
    render () {
      return super.render() // è¿™ä¸ª super å°±æ˜¯ WrappedComponent çš„åŸå‹å¯¹è±¡
    }
  }
}
```

è€Œå¦‚æœæˆ‘ä»¬åœ¨`MyHOC`ä¸­è¿”å›çš„åŒ¿åç»„ä»¶ä¸­ä¹Ÿæœ‰`componentDidMount`çš„è¯ï¼Œå°±ä¼šæŠŠ`WrappedComponent`ä¸Šçš„ç”Ÿå‘½å‘¨æœŸç»™è¦†ç›–ï¼š

```diff
function MyHOC (WrappedComponent) {
  console.log(WrappedComponent.prototype.componentDidMount)
  console.log(WrappedComponent.prototype.render)
  return class extends WrappedComponent {
+   componentDidMount () {
+     console.log('MyHoc componentDidMount')
+   }
    render () {
      return super.render()
    }
  }
}
```

æ§åˆ¶å°æœ€ç»ˆæ‰“å°å‡ºæ¥çš„ä¼šæ˜¯`"MyHoc componentDidMount"`ã€‚

è¿™ä¸ªğŸ‘†åº”è¯¥å¾ˆå¥½ç†è§£å§ï¼Œå””ï¼Œé‚£ç°åœ¨æˆ‘ä¹Ÿæƒ³è¦ä¿ç•™`WrappedComponent`ä¸Šçš„ç”Ÿå‘½å‘¨æœŸè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå’¦ï½å¯ä»¥ä½¿ç”¨`apply`å†è°ƒç”¨ä¸€æ¬¡å‘€ï¼ŒğŸ˜„ï¼š

```diff
function MyHOC (WrappedComponent) {
  console.log(WrappedComponent.prototype.componentDidMount)
  console.log(WrappedComponent.prototype.render)
+ const wrappedDidMount = WrappedComponent.prototype.componentDidMount;
  return class extends WrappedComponent {
	  componentDidMount () {
	    console.log('MyHoc componentDidMount')
+     if (wrappedDidMount) {
+       wrappedDidMount.apply(this)
+     }
	  }
    render () {
      return super.render()
    }
  }
}
```

ç°åœ¨ï¼Œå®Œç¾çš„åŠ«æŒäº†ä¼ å…¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥æ¥åšæ›´å¤šæœ‰è¶£çš„äº‹æƒ…äº†ã€‚



#### 2.2.4 è°ƒç”¨ç»„ä»¶çš„é™æ€æ–¹æ³•

åœ¨å®ç°**åŠ«æŒç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**çš„è¿™ä¸ªç”¨æ³•æ—¶ï¼Œå¼•å‘äº†æˆ‘çš„å¦ä¸€ä¸ªæ€è€ƒï¼Œä¸è®ºæ˜¯**å±æ€§ä»£ç†**çš„æ–¹å¼è¿˜æ˜¯ç°åœ¨çš„**åå‘ç»§æ‰¿**ï¼Œéƒ½å¯ä»¥æ‹¿åˆ°ä¼ å…¥è¿›æ¥çš„ç»„ä»¶ï¼Œé‚£ä¹ˆå¯¹äºåŸç»„ä»¶`ç”Ÿå‘½å‘¨æœŸã€é™æ€æ–¹æ³•`çš„è·å–åº”è¯¥éƒ½æ˜¯é€‚ç”¨çš„ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œé™æ€æ–¹æ³•çš„å®šä¹‰æ˜¯åœ¨ç”³æ˜å‡½æ•°æ—¶ï¼Œå‰é¢åŠ ä¸Š`static`æ ‡è¯†ç¬¦è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç›´æ¥å®šä¹‰åœ¨`Class`ä¸Šçš„æ–¹æ³•ï¼Œå¹¶ä¸èƒ½è¢«`Class`çš„å®ä¾‹å¯¹è±¡è°ƒç”¨ï¼š

```jsx
class TestComponent extends React.Component {
	static staticFn () {
		console.log('æˆ‘æ˜¯Testä¸­çš„é™æ€æ–¹æ³•')
	}
  render () {
    return(
      <div>TestComponent</div>
    )
  }
}
```

æ‰€ä»¥å…¶å®æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è¿›è¡Œè°ƒç”¨ï¼š

```jsx
function MyHOC (WrappedComponent) {
  WrappedComponent.staticFn()
}
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdb32ba2664f434fb59d0f27ddd57890~tplv-k3u1fbpfcp-zoom-1.image)


## 3. HOCçš„å‡ ç§ä½¿ç”¨æ–¹å¼

### 3.1 å‡½æ•°å®ç°

è¿™ç§å®ç°æ–¹å¼å°±åƒä¸Šé¢æ‰€æœ‰æ¡ˆä¾‹ä¸­å†™çš„ä¸€æ ·ï¼Œç›´æ¥å®šä¹‰ä¸€ä¸ªæ¥æ”¶ç»„ä»¶ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œç„¶åè°ƒç”¨ï¼š

```jsx
function MyHOC (WrappedComponent) {
 // ...
}
class TestComponent extends React.Component {}

const FinalComponent = MyHOC(TestComponent);
export default FinalComponent;
```

ä½¿ç”¨æ—¶å°±å½“æ™®é€šçš„ç»„ä»¶æ¥ä½¿ç”¨å°±è¡Œäº†ï¼š

*App.js*:

```jsx
import FinalComponent from './FinalComponent';
class App extends React.Component {
	render () {
    return (
      <div className="App">
      	<FinalComponent />
			</div>
		)
	}
}
```



### 3.2 composeç»„åˆ

ä¸Šé¢å®šä¹‰çš„æ˜¯ä¸€ä¸ª`HOC`çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä¸€ä¸ªç»„ä»¶éœ€è¦ä½¿ç”¨åˆ°å¤šä¸ª`HOC`å‘¢ï¼Ÿ

```jsx
function MyHOC1 (WrappedComponent) {
 // ...
}
function MyHOC2 (WrappedComponent) {
 // ...
}
function MyHOC3 (WrappedComponent) {
 // ...
}
class TestComponent extends React.Component {}

const FinalComponent = MyHOC3(MyHOC2(MyHOC1(TestComponent)));
export default FinalComponent;
```

é¢ï¼Œè¿™...å¥½ä¸‘å•Šï¼Œä½œä¸ºä¸€åæœ‰è¿½æ±‚çš„å‰ç«¯ï¼Œä¸èƒ½å¿å•Šã€‚

é‚£å’±æ¥å†™ä¸ª`compose`å‡½æ•°è°ƒæ•´ä¸€ä¸‹å§ï¼š

```jsx
 const compose = (...fns) => fns.reduce((pre, cur) => (...args) => cur(pre(...args)));

 const FinalComponent = compose(MyHOC3, MyHOC2, MyHoc1)(TestComponent);
 export default FinalComponent;
```

æˆ–è€…ï¼Œå·ä¸ªæ‡’ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç°åœ¨å¸‚é¢ä¸Šå·²ç»æœ‰çš„ä¸€äº›å·¥å…·åº“ï¼Œå°±åƒæ˜¯`lodash`ä¸­æœ‰æä¾›`flowRight`å¯ä»¥å®ç°ä»¥ä¸Šæ•ˆæœã€‚



### 3.3 Decorators

è¿˜æœ‰ä¸€ç§æ¯”è¾ƒéªšçš„æ“ä½œå°±æ˜¯åˆ©ç”¨`ES7`çš„è£…é¥°å™¨`Decorators`ï¼š

```jsx
@MyHOC3
@MyHOC2
@MyHOC1
class TestComponent extends React.Component {}
```

ä¸è¿‡è¿™ç§æ–¹å¼éœ€è¦æˆ‘ä»¬å®‰è£…ä¸€ä¸‹`Babel`çš„æ’ä»¶ï¼š`@babel/plugin-proposal-decorators`ã€‚

å®‰è£…ï¼š

```
npm install --save-dev @babel/plugin-proposal-decorators
```

ä½¿ç”¨(åœ¨é…ç½®`Babel`çš„åœ°æ–¹æ·»åŠ ä¸€ä¸‹è¯¥æ’ä»¶çš„é…ç½®)ï¼š

```json
{
  "plugins": ["@babel/plugin-proposal-decorators"]
}
```

è¿™å°¼ğŸå¥½é…·çš„æ ·å­ã€‚



### 3.4 composeç»“åˆDecorators

è¿˜æœ‰æ²¡æœ‰æ›´é…·ä¸€ç‚¹çš„ç”¨æ³•å‘¢ï¼Ÿ

å’±ä¹Ÿè®¸è¿˜å¯ä»¥å°†`compose`å’Œ`Decorators`ç»„åˆèµ·æ¥ï¼Œå°±åƒæ˜¯è¿™æ ·ï¼š

```jsx
const MyHOC = compose(MyHOC3, MyHOC2, MyHoc1);

@MyHOC
class TestComponent extends React.Component {}
```

`GOODï¼BOYï¼`



## 4. HOCçš„å®é™…ç”¨æ³•

å…¶å®ä¸Šé¢è¯´æ˜äº†å¾ˆå¤šç§`HOC`çš„ç”¨æ³•ï¼Œå¦‚æœä½ æ˜¯æœ‰è®¤çœŸçœ‹çš„è¯æˆ‘ç›¸ä¿¡æ˜¯èƒ½å¼•å‘ä½ çš„ä¸€äº›æ€è€ƒçš„ï¼Œå¯èƒ½ä½ åœ¨çœ‹çš„è¿‡ç¨‹ä¸­å°±ä¼šæƒ³åˆ°è¿™ç§æ–¹å¼èƒ½ç»™æˆ‘åœ¨å®é™…å¼€å‘ä¸­å¸¦æ¥ä»€ä¹ˆå¥½å¤„å—ğŸ¤”ï¸ï¼Ÿ

å””ï¼Œå‘†å‘†ç›¸ä¿¡ä½ ä»¬éƒ½æ¯”æˆ‘èªæ˜ï¼Œè‚¯å®šèƒ½å°†å®ƒçš„ä½œç”¨å‘æŒ¥çš„å¾ˆå¥½ã€‚

é‚£ä¹ˆæˆ‘è¿™é‡Œå°±æŠ›ç –å¼•ç‰ï¼Œä¾‹ä¸¾å‡ºä¸€äº›åœ¨å·¥ä½œä¸­å¯ä»¥ç”¨åˆ°çš„åœ°æ–¹ã€‚




#### 4.1 æå–å…¬å…±éƒ¨åˆ†

å””...å…¶å®æ€ä¹ˆè¯´å‘¢ï¼Œåˆšåˆšè¯´åˆ°çš„è¿™äº›ç”¨æ³•ï¼Œä¾‹å¦‚å±æ€§ä»£ç†æ“ä½œ`props`æ·»åŠ å…¬å…±å±æ€§ï¼Œæˆ–è€…åå‘ç»§æ‰¿å¦‚è·å–åˆ°`WrappedComponent`çš„`stateã€ref`ç­‰æ“ä½œå¹¶ä¸æ˜¯è¯´æ˜¯ä½¿ç”¨`HOC`æ‰èƒ½å®ç°çš„åŠŸèƒ½ï¼Œè€Œæ˜¯è¦è®©æˆ‘ä»¬å›å½’åˆ°`HOC`çš„ä¸€å¤§ç‰¹ç‚¹ä¸­æ¥ï¼šå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬**å¤ç”¨ç»„ä»¶é€»è¾‘**ã€‚è€Œå‰é¢æåˆ°çš„è¿™äº›åªæ˜¯å®ƒçš„ä¸€äº›å…·ä½“ç”¨æ³•ã€‚

å°±åƒæˆ‘ä»¬æƒ³è¦å®ç°`æ“ä½œpropsæ·»åŠ å±æ€§`è¿™ä¸ªåŠŸèƒ½ä¸€æ ·ï¼š

```jsx
class A extends React.Component {
  render () {
    return <div>æˆ‘æ˜¯ç»„ä»¶A, æˆ‘éœ€è¦å…¬å…±çš„å±æ€§{this.props.commonProps}</div>
  }
}
class B extends React.Component {
  render () {
    const newProps = { // é‡ç‚¹çœ‹è¿™é‡Œ
      ...this.props,
      commonProps: 'æˆ‘æ˜¯å…¬å…±çš„å±æ€§'
    }
    return (
      <div>
        ç»„ä»¶B
        <A {...newProps}></A>
      </div>
    )
  }
}
export default B;
```

åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼š

```jsx
<B id={1}></B>
```

æ­¤æ—¶ç»„ä»¶`A`ä¸­çš„`props`ä¹Ÿæ˜¯èƒ½æ¥æ”¶åˆ°`id`å’Œ`commonProps`çš„ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é€ä¼ `props`çš„æƒ…æ™¯ã€‚

ä½†å¦‚æœæ­¤æ—¶å¦ä¸€ä¸ªç»„ä»¶`C`æƒ³è¦å’Œç»„ä»¶`A`æœ‰ä¸€æ ·çš„`commonProps`çš„è¯ï¼Œæˆ–è€…ç»„ä»¶`D`ï¼Œç»„ä»¶`E`ä¹Ÿæƒ³è¦æœ‰ï¼Œè€Œè¿™æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³åˆ°æŠŠè¿™äº›å…¬å…±çš„å±æ€§æå–å‡ºæ¥æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ç»Ÿä¸€ç®¡ç†ï¼Œç„¶ååˆ©ç”¨ä¸Šé¢è¿™ç§é€ä¼ `props`çš„æ–¹å¼æ¥åšã€‚

å””ï¼Œä¸ä¹…ä¹‹åï¼Œä½ çš„ä»£ç å¯èƒ½å°±ä¼šå˜æˆè¿™æ ·äº†ï¼š

(é¢ï¼Œä¸‹é¢çš„ç»„ä»¶Aå’Œç»„ä»¶Bå’Œä¸Šé¢é‚£ä¸ªæ¡ˆä¾‹å°±æ²¡æœ‰å…³ç³»äº†)

```jsx
// ä¸€å¥—å¾ˆå¤æ‚çš„é€»è¾‘å¾—åˆ°çš„ commonProps
const commonProps = {
	looks: 'handsome',
	character: 'lively'
}

function TestComponent () {
  return (
    <>
    	/* ä¸€äº›å…¬å…±çš„å¤–å£³ */
      <div className='commonWrapped'>
      	<A {...commonProps}></A>
    	</div>
    	<div className='commonWrapped'>
      	<B {...commonProps}></A>
    	</div>
    	<div className='commonWrapped'>
      	<C {...commonProps}></A>
    	</div>
    	<div className='commonWrapped'>
      	<D {...commonProps}></A>
    	</div>
    </>
  )
}
```

æ­¤æ—¶ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç”¨`HOC`å¯ä»¥æ€æ ·åšï¼š

```jsx
function MyHOC (WrappedComponent) {
  // ä¸€å¥—å¾ˆå¤æ‚çš„é€»è¾‘
  const commonProps = {
    looks: 'handsome',
    character: 'lively'
  }
  render () {
    return (
      <div className='commonWrapped'>
      	<WrappedComponent />
      </div>
    )
  }
}
function TestComponent () {
  return (
    <>
    	{MyHOC(A)}
      {MyHOC(B)}
      {MyHOC(C)}
      {MyHOC(D)}
    </>
  )
}
```

é«˜ç«¯ã€éœ¸æ°”ã€ä¸Šæ¡£æ¬¡ï¼

è€Œä¸”å¯¹äºä¸€äº›å¤æ‚é€»è¾‘å’Œå…¬å…±çš„éƒ¨åˆ†æˆ‘ä»¬éƒ½å¯ä»¥åœ¨`MyHOC`ä¸­ç»Ÿä¸€çš„ç®¡ç†ï¼Œè€å¤§è¯´ï¼šè¿™å°±æ˜¯æˆ‘æƒ³è¦çœ‹åˆ°çš„ä»£ç ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce721d3907954265a7db5671794ac991~tplv-k3u1fbpfcp-zoom-1.image)



#### 4.2 ç»„ä»¶æ—¥å¿—æ‰“ç‚¹

è¿™ä¸ªç”¨æ³•çš„çµæ„Ÿå…¶å®æ¥è‡ªäºä¸Šé¢`2.2.1 æ“ä½œstate`ï¼Œå¯¹äºä¸€äº›é¡µé¢æˆ–è€…ç»„ä»¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ¥è¿›è¡Œä¸€äº›æ—¥å¿—æ‰“ç‚¹çš„æ“ä½œã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª`logHOC`æ¥å¸®åŠ©æˆ‘ä»¬å¤ç”¨è¿™ä¸ªé€»è¾‘ï¼Œå°±åƒä¸‹é¢çš„è¿™æ®µä»£ç ï¼Œå¯ä»¥å¸®æˆ‘ä»¬æŸ¥çœ‹ç»„ä»¶çš„æ¸²æŸ“æ—¶é—´å’Œè°ƒç”¨åˆ°é”€æ¯çš„è®°å½•ï¼š

```jsx
import React from 'react';

function logHOC (WrappedComponent) {
  return class extends React.Component {
    start;
    end;
    componentWillMount() {
      this.start = Date.now();
    }
    componentDidMount() {
      this.end = Date.now();
      console.log(`${WrappedComponent.dispalyName} æ¸²æŸ“çš„æ—¶é—´ï¼š${this.end - this.start} ms`);
      console.log(`è°ƒç”¨äº†${WrappedComponent.dispalyName}`);
    }
    componentWillUnmount() {
      console.log(`é”€æ¯äº†${WrappedComponent.dispalyName}`);
    }
    render() {
      return <WrappedComponent {...this.props} />
    }
  }
}
class TestComponent extends React.Component {
  render () {
    return(
      <div>TestComponent1</div>
    )
  }
}
const FinalComponent = logHOC(TestComponent);
export default FinalComponent;
```





## 5. ä½¿ç”¨HOCéœ€è¦æ³¨æ„çš„ç‚¹

è™½è¯´`HOC`çš„å¥½å¤„éå¸¸å¤šï¼Œä½†å…¶å®ä¹Ÿè¿˜æ˜¯æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±åƒæ˜¯ä¸‹é¢ğŸ‘‡è¿™äº›æƒ…å†µï¼š

ä¸€ã€ä¸è¦åœ¨`render`å‡½æ•°å†…å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶

å¯¹äºé«˜é˜¶ç»„ä»¶ï¼Œæˆ‘ä»¬æ¯æ¬¡è°ƒç”¨å®ƒç”Ÿæˆçš„éƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ï¼Œè¿™æ ·ç»„ä»¶çš„å”¯ä¸€æ ‡è¯†ä¹Ÿå°±å˜äº†ï¼Œæ‰€ä»¥å¦‚æœåœ¨`render`ä¸­è°ƒç”¨äº†é«˜é˜¶ç»„ä»¶ï¼Œå°†ä¼šå¯¼è‡´ç»„ä»¶æ¯æ¬¡éƒ½å¸è½½åé‡æ–°æŒ‚è½½ã€‚



äºŒã€ä¸è¦å»æ”¹å˜åŸå§‹çš„ç»„ä»¶

å› ä¸ºå®˜æ–¹å¯¹äºé«˜é˜¶ç»„ä»¶çš„å®šä¹‰æ˜¯ï¼š`é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚`

å¹¶ä¸”å¯¹äºçº¯å‡½æ•°ï¼š

> å¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚ è¯¥å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡æˆ–æ•°æ®çªå˜ã€‚

æ‰€ä»¥å¦‚æœå¯¹åŸç»„ä»¶ä¿®æ”¹äº†å°±è¿èƒŒäº†æˆ‘ä»¬é«˜é˜¶ç»„ä»¶çš„å®šä¹‰ï¼Œä½†æ˜¯ä½ å¯ä»¥å»**åŠ å¼º**å®ƒï¼Œè¿™å’Œ**æ”¹å˜**åŸç»„ä»¶ä¸ä¸€æ ·ã€‚



ä¸‰ã€é€ä¼ ä¸ç›¸å…³çš„`props`

è¿™ç‚¹æˆ‘è®¤ä¸ºä¹Ÿæ˜¯éœ€è¦éµå®ˆçš„ï¼Œå› ä¸ºå½“æˆ‘ä»¬åœ¨ä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰äº›`props`ä½ åœ¨`HOC`å¹¶ä¸ç”¨åˆ°ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯å¾—å°†å®ƒé€ä¼ ç»™åŸç»„ä»¶å»ã€‚



## å‚è€ƒæ–‡ç« 

- [ã€Reactæ·±å…¥ã€‘ä»Mixinåˆ°HOCå†åˆ°Hook](https://juejin.im/post/6844903815762673671)
- [Reacté«˜é˜¶ç»„ä»¶(HOC)çš„å…¥é—¨åŠå®è·µ](https://juejin.im/post/6844904050236850184)
- [Reactæ–‡æ¡£cloneElement](https://zh-hans.reactjs.org/docs/react-api.html#cloneelement)



## åè¯­

ä½ ç›¼ä¸–ç•Œï¼Œæˆ‘ç›¼æœ›ä½ æ— `bug`ã€‚è¿™ç¯‡æ–‡ç« å°±ä»‹ç»åˆ°äº†è¿™é‡Œã€‚

æ€»ç®—æ˜¯å†™å®Œäº†ğŸ˜‚ï¼Œèƒ½çœ‹åˆ°æœ€åçš„ä½ ä¹Ÿå¾ˆå‰å®³ã€‚å› ä¸ºå‘†å‘†ä¹Ÿæ˜¯æœ€è¿‘æ‰è½¬çš„`React`ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçœŸçš„å¾ˆçµæ´»ï¼Œä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œä½†æƒ³è¦çœŸæ­£çš„å­¦å¥½å®ƒå¯èƒ½è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ä¹Ÿæ˜¯ï¼Œæ‰€ä»¥ï¼š**è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œä¸€èµ·å…¥å‘ä¹ï¼Ÿ**ï¼Œå“ˆå“ˆå“ˆã€‚

æœ€åï¼Œæˆ‘ä»¬æ˜¯**å¸Œæ²ƒENOWå¤§å‰ç«¯**ï¼Œå¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œå””ï¼Œä½ æ‡‚å¾—[å¥¸ç¬‘ï½]ï¼Œä¸‹å‘¨å†è§äº†ğŸ‘‹æ‹œæ‹œã€‚

